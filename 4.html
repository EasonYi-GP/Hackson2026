<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flavor Tribes</title>
    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Noto+Serif+SC:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Noto Serif SC', 'serif'],
                        display: ['Playfair Display', 'serif'],
                    },
                    colors: {
                        'fresh-base': '#10b981',
                        'creamy-base': '#f59e0b',
                        'hardcore-base': '#e11d48',
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'bubble-rise': 'rise 4s infinite ease-in',
                        'ember-fly': 'fly 3s infinite linear',
                        'liquid-sway': 'sway 8s infinite ease-in-out',
                        'pulse-glow': 'pulseGlow 2s infinite',
                    },
                    keyframes: {
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } },
                        rise: { '0%': { bottom: '-30px', opacity: 0, transform: 'translateX(0)' }, '20%': {opacity: 0.8}, '100%': { bottom: '150%', opacity: 0, transform: 'translateX(-20px)' } },
                        fly: { '0%': { transform: 'translateY(0) translateX(0) scale(1)', opacity: 1 }, '100%': { transform: 'translateY(-150px) translateX(30px) scale(0)', opacity: 0 } },
                        sway: { '0%, 100%': { transform: 'rotate(-3deg) scale(1.1)' }, '50%': { transform: 'rotate(3deg) scale(1)' } },
                        pulseGlow: { '0%, 100%': { boxShadow: '0 0 10px currentColor' }, '50%': { boxShadow: '0 0 30px currentColor, 0 0 50px currentColor' } }
                    }
                }
            }
        }
    </script>
    <style>
        /* å…¨å±€éšè—æ‰€æœ‰æ»šåŠ¨æ¡ */
        * {
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE and Edge */
        }
        *::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
            width: 0;
            height: 0;
        }

        body { font-family: 'Inter', sans-serif; }
        .serif-font { font-family: 'Noto Serif SC', serif; }

        .hide-scroll::-webkit-scrollbar { width: 4px; }
        .hide-scroll::-webkit-scrollbar-track { background: transparent; }
        .hide-scroll::-webkit-scrollbar-thumb { background: #334155; border-radius: 2px; }

        /* æ·±æ¸ŠèƒŒæ™¯ */
        .abyssal-bg {
            background-color: #020617;
            background-image:
                radial-gradient(circle at 15% 50%, rgba(30, 27, 75, 0.4) 0%, transparent 25%),
                radial-gradient(circle at 85% 30%, rgba(15, 23, 42, 0.6) 0%, transparent 25%);
            min-height: 100vh;
        }

        /* ç»ç’ƒé¢æ¿ */
        .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.03);
            border-radius: 20px;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .effect-container { position: absolute; inset: 0; overflow: hidden; border-radius: inherit; pointer-events: none; }
        
        /* å¢å¼ºçš„åŠ¨æ•ˆå…ƒç´  */
        .bubble { 
            position: absolute; 
            background: rgba(255,255,255,0.6); 
            border-radius: 50%; 
            box-shadow: 0 0 5px rgba(255,255,255,0.4);
        }
        .ember { 
            position: absolute; 
            width: 4px; 
            height: 4px; 
            background: #fca5a5; 
            border-radius: 50%; 
            box-shadow: 0 0 8px #ef4444, 0 0 12px #ef4444; 
        }
        
        .tribe-selected {
            border: 2px solid rgba(255,255,255,0.8) !important;
            transform: scale(1.03);
            box-shadow: 0 20px 50px -10px rgba(0,0,0,0.8) !important;
            z-index: 10;
        }

        .btn-enabled {
            background: linear-gradient(90deg, #ec4899, #f43f5e, #fbbf24);
            background-size: 200% 200%;
            animation: gradientMove 3s ease infinite;
        }
        @keyframes gradientMove { 
            0% { background-position: 0% 50% } 
            50% { background-position: 100% 50% } 
            100% { background-position: 0% 50% } 
        }

        /* Dynamic Background */
        .mystic-bg {
            background-color: #020617;
            background-image:
                radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%),
                radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%),
                radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%);
            position: absolute; inset: 0; z-index: -1;
        }

        
            50% { opacity: 0.95; transform: translateY(-50vh) translateX(var(--drift)); }
            95% { opacity: 0.8; }
            100% { transform: translateY(-100vh) translateX(calc(var(--drift) * 1.5)); opacity: 0; }
        }
    </style>
</head>
<body class="text-slate-200 min-h-screen relative font-sans overflow-x-hidden">

    <div class="mystic-bg"></div>
    <!-- Main Content -->
    <div class="relative z-10 flex flex-col md:flex-row min-h-screen p-2 md:p-4 gap-4 max-w-7xl mx-auto">

        <!-- å·¦ä¾§å¯¼èˆªæ  -->
        <aside class="glass-panel w-full lg:w-64 flex flex-col p-6 shadow-2xl shrink-0 lg:h-[calc(100vh-3rem)] lg:sticky lg:top-6">
            <div class="mb-8 flex lg:block items-center justify-between">
                <div>
                    <p class="text-[10px] text-amber-700/80 tracking-[0.3em] font-bold">EST. 2026</p>
                    <h1 class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-br from-amber-100 to-amber-600 serif-font mt-1">
                        åŠæ¯è¯—ç¤¾
                    </h1>
                </div>
                <button class="lg:hidden text-slate-400">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                    </svg>
                </button>
            </div>

            <!-- å¯¼èˆªèœå• -->
            <nav class="hidden lg:flex flex-col gap-2 flex-1">
                <a href="1.html" class="flex items-center gap-3 px-4 py-3 text-slate-500 hover:text-slate-300 hover:bg-white/5 rounded-xl transition-all group">
                    <svg class="w-5 h-5 group-hover:text-amber-500/50 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                    </svg>
                    <span>å¤§å… Hall</span>
                </a>
                <a href="2.html" class="flex items-center gap-3 px-4 py-3 text-slate-500 hover:text-slate-300 hover:bg-white/5 rounded-xl transition-all group">
                    <svg class="w-5 h-5 group-hover:text-amber-500/50 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                    </svg>
                    <span>æ–°äººå‘å¯¼ Guide</span>
                </a>
                <a href="3.html" class="flex items-center gap-3 px-4 py-3 text-slate-500 hover:text-slate-300 hover:bg-white/5 rounded-xl transition-all group">
                    <svg class="w-5 h-5 group-hover:text-amber-500/50 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
                    </svg>
                    <span>å¾®é†ºä¼šè¯ Session</span>
                </a>
                <a href="4.html" class="flex items-center gap-3 px-4 py-3 bg-white/5 text-amber-50 rounded-xl border border-white/5 font-medium transition-all group">
                    <svg class="w-5 h-5 text-amber-500/80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                    </svg>
                    <span>åœˆå­ Circles</span>
                </a>
                <a href="6.html" class="flex items-center gap-3 px-4 py-3 text-slate-500 hover:text-slate-300 hover:bg-white/5 rounded-xl transition-all group">
                    <svg class="w-5 h-5 group-hover:text-amber-500/50 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    <span>æˆ‘çš„æ¡£æ¡ˆ Profile</span>
                </a>
            </nav>

            <!-- ç”¨æˆ·ä¿¡æ¯ -->
            <div class="hidden lg:flex mt-auto pt-6 border-t border-white/5 items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-amber-900/30 border border-amber-500/20 flex items-center justify-center text-amber-500 font-bold text-xs ring-4 ring-black">
                    ME
                </div>
                <div>
                    <p class="text-sm text-amber-500/80 font-bold">é…’å®¢ #0608</p>
                    <p class="text-[10px] text-slate-500">å¾®é†ºæ¢é™©å®¶</p>
                </div>
            </div>
        </aside>

        <!-- LEFT COLUMN: TRIBE SELECTOR -->
        <div class="w-full md:w-1/3 flex flex-col gap-3 h-full">
            <header class="mb-1">
                <h1 class="text-xl font-bold italic tracking-wider text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-cyan-300">
                    é€‰æ‹©ä½ çš„é£å‘³é¢‘ç‡
                    <span class="block text-[10px] font-normal text-slate-400 not-italic mt-0.5">å¯»æ‰¾ä¸ä½ å‘³è•¾å…±é¸£çš„ä¼™ä¼´</span>
                </h1>
            </header>

            <!-- Card 1: Poetic (Violet) -->
            <div onclick="selectTribe('poetic')" id="tribe-poetic" class="relative group cursor-pointer flex-1 rounded-2xl bg-violet-900/40 border border-violet-500/30 p-3 flex flex-col justify-end transition-all duration-300 overflow-hidden tribe-selected hover:border-violet-400/50">
                <div class="effect-container">
                    <div class="absolute inset-0 bg-gradient-to-t from-violet-900/90 via-transparent to-transparent"></div>
                    <div class="absolute top-0 right-0 w-full h-full opacity-30 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')]"></div>
                </div>
                
                <div class="relative z-10">
                    <div class="flex justify-between items-end">
                        <div class="space-y-0.5">
                            <div class="text-violet-300 font-mono text-[10px] mb-0.5 bg-violet-900/50 inline-block px-1 rounded">#çµæ„Ÿ #æœˆå…‰ #è¯—æ„</div>
                            <h2 class="text-xl font-bold text-white leading-none drop-shadow-lg">å¾®é†ºè¯—äºº</h2>
                            <p class="text-violet-100/70 text-[10px] mt-0.5 line-clamp-1">ç¬”å°–æµæ·Œçš„ä¸ä»…æ˜¯å¢¨æ°´ï¼Œè¿˜æœ‰æœˆå…‰ä¸é…’é¦™ã€‚</p>
                        </div>
                        <i class="fa-solid fa-feather-pointed text-2xl text-violet-400 drop-shadow-[0_0_10px_rgba(167,139,250,0.5)] group-hover:scale-110 group-hover:-rotate-12 transition-transform"></i>
                    </div>
                </div>
            </div>

            <!-- Card 2: Electro (Rose) -->
            <div onclick="selectTribe('electro')" id="tribe-electro" class="relative group cursor-pointer flex-1 rounded-2xl bg-rose-900/40 border border-rose-500/30 p-3 flex flex-col justify-end transition-all duration-300 overflow-hidden opacity-60 scale-95 hover:border-rose-400/50">
                <div class="effect-container">
                    <div class="ember left-[20%] top-[90%] animate-ember-fly" style="animation-delay: 0.1s"></div>
                    <div class="ember left-[50%] top-[80%] animate-ember-fly" style="animation-delay: 0.5s"></div>
                    <div class="absolute inset-0 bg-gradient-to-t from-rose-900/90 via-transparent to-transparent"></div>
                </div>

                <div class="relative z-10">
                    <div class="flex justify-between items-end">
                        <div class="space-y-0.5">
                            <div class="text-rose-300 font-mono text-[10px] mb-0.5 bg-rose-900/50 inline-block px-1 rounded">#Rave #èƒ½é‡ #é‡Šæ”¾</div>
                            <h2 class="text-xl font-bold text-white leading-none drop-shadow-lg">ç‡¥çƒ­ç”µéŸ³</h2>
                            <p class="text-rose-100/70 text-[10px] mt-0.5 line-clamp-1">è·Ÿéšå¼ºåŠ²çš„å¾‹åŠ¨ï¼Œé‡Šæ”¾ä½“å†…æ‰€æœ‰çš„å¤šå·´èƒºã€‚</p>
                        </div>
                        <i class="fa-solid fa-bolt text-2xl text-rose-500 drop-shadow-[0_0_15px_rgba(244,63,94,0.8)] group-hover:scale-110 transition-transform"></i>
                    </div>
                </div>
            </div>

            <!-- Card 3: Whisper (Amber) -->
            <div onclick="selectTribe('whisper')" id="tribe-whisper" class="relative group cursor-pointer flex-1 rounded-2xl bg-amber-900/40 border border-amber-500/30 p-3 flex flex-col justify-end transition-all duration-300 overflow-hidden opacity-60 scale-95 hover:border-amber-400/50">
                <div class="effect-container">
                    <div class="absolute -bottom-1/2 -left-1/2 w-[200%] h-[200%] bg-amber-600/30 rounded-[40%] animate-liquid-sway filter blur-2xl opacity-60"></div>
                    <div class="absolute inset-0 bg-gradient-to-t from-amber-900/90 via-transparent to-transparent"></div>
                </div>

                <div class="relative z-10">
                    <div class="flex justify-between items-end">
                        <div class="space-y-0.5">
                            <div class="text-amber-300 font-mono text-[10px] mb-0.5 bg-amber-900/50 inline-block px-1 rounded">#æœºé‡ #åˆä½œ #è¿æ¥</div>
                            <h2 class="text-xl font-bold text-white leading-none drop-shadow-lg">å•†åŠ¡æ´½è°ˆ</h2>
                            <p class="text-amber-100/70 text-[10px] mt-0.5 line-clamp-1">åœ¨æ¯é…’ä¹‹é—´äº¤æ¢è§†é‡ï¼Œäºè°ˆç¬‘ä¹‹ä¸­è¾¾æˆå…±è¯†ã€‚</p>
                        </div>
                        <i class="fa-solid fa-handshake text-2xl text-amber-400 drop-shadow-[0_0_10px_rgba(251,191,36,0.5)] group-hover:scale-110 transition-transform"></i>
                    </div>
                </div>
            </div>

            <!-- Card 4: Solo (Cyan) -->
            <div onclick="selectTribe('solo')" id="tribe-solo" class="relative group cursor-pointer flex-1 rounded-2xl bg-cyan-900/40 border border-cyan-500/30 p-3 flex flex-col justify-end transition-all duration-300 overflow-hidden opacity-60 scale-95 hover:border-cyan-400/50">
                <div class="effect-container">
                    <div class="bubble w-2 h-2 left-[20%] animate-bubble-rise" style="animation-delay: 0s"></div>
                    <div class="bubble w-3 h-3 left-[70%] animate-bubble-rise" style="animation-delay: 0.5s"></div>
                    <div class="absolute inset-0 bg-gradient-to-t from-cyan-900/90 via-transparent to-transparent"></div>
                </div>

                <div class="relative z-10">
                    <div class="flex justify-between items-end">
                        <div class="space-y-0.5">
                            <div class="text-cyan-300 font-mono text-[10px] mb-0.5 bg-cyan-900/50 inline-block px-1 rounded">#ç‹¬å¤„ #ç™½å™ªéŸ³ #è‡ªåœ¨</div>
                            <h2 class="text-xl font-bold text-white leading-none drop-shadow-lg">ç‹¬è‡ªæ”¾ç©º</h2>
                            <p class="text-cyan-100/70 text-[10px] mt-0.5 line-clamp-1">äº«å—ä¸€ä¸ªäººçš„å®é™ï¼Œä¸ä¸–ç•Œä¿æŒå¾®é†ºçš„è·ç¦»ã€‚</p>
                        </div>
                        <i class="fa-solid fa-wind text-2xl text-cyan-400 drop-shadow-[0_0_10px_rgba(34,211,238,0.5)] group-hover:scale-110 transition-transform"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- RIGHT COLUMN: INTERACTION ZONE -->
        <div class="w-2/3 flex flex-col h-full bg-slate-900/60 backdrop-blur-xl rounded-3xl border border-white/10 overflow-hidden shadow-2xl">
            
            <!-- Top Bar -->
            <div id="right-header-bg" class="h-32 relative flex items-center px-8 transition-colors duration-500 bg-amber-900/30">
                <div class="absolute inset-0 overflow-hidden pointer-events-none">
                    <div class="absolute -right-10 -top-10 w-64 h-64 bg-white/5 rounded-full blur-3xl"></div>
                </div>
                <div class="relative z-10 w-full">
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="flex items-center gap-3 mb-2">
                                <span id="header-icon-container" class="w-10 h-10 rounded-full bg-amber-500 flex items-center justify-center text-slate-900 shadow-lg shadow-amber-500/50 transition-colors duration-300">
                                    <i id="header-icon" class="fa-solid fa-martini-glass-citrus text-lg"></i>
                                </span>
                                <div>
                                    <span id="header-title" class="text-2xl font-bold block leading-none tracking-wide text-white drop-shadow-md">å¾®é†ºå¥¶é¦™ç»„</span>
                                    <span class="text-sm opacity-80 block mt-1 text-slate-300">äº’åŠ¨ä¸“åŒº</span>
                                </div>
                            </div>
                            <div class="flex gap-4 text-xs font-mono opacity-80 text-slate-300">
                                <span class="flex items-center gap-1.5"><i class="fa-solid fa-user-group"></i> 24äºº åœ¨çº¿</span>
                                <span class="flex items-center gap-1.5"><i class="fa-solid fa-signal text-green-400"></i> çƒ­åº¦ï¼šé«˜</span>
                            </div>
                        </div>
                        
                        <!-- Mini Live Ticker -->
                        <div class="hidden md:block bg-black/40 backdrop-blur rounded-lg p-3 max-w-xs border border-white/10 shadow-lg">
                             <div class="text-[10px] text-emerald-400 mb-1 flex items-center gap-2 font-bold tracking-wider">
                                 <span class="relative flex h-2 w-2">
                                    <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                                    <span class="relative inline-flex rounded-full h-2 w-2 bg-emerald-500"></span>
                                  </span>
                                 å®æ—¶åŠ¨æ€ (LIVE)
                             </div>
                             <div id="live-feed-text" class="text-xs text-slate-200 truncate transition-opacity duration-300">Ray æ­£åœ¨å¬é…’å§çš„çˆµå£«ä¹ ğŸµ...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Members Grid -->
            <div class="flex-1 overflow-y-auto p-6 no-scrollbar bg-slate-900/30">
                <h3 class="text-sm text-slate-400 font-bold mb-4 flex items-center gap-2 tracking-wide uppercase">
                    <i class="fa-solid fa-location-dot text-indigo-400"></i>
                    ç°åœºé…’å‹ (Members in Bar)
                </h3>
                
                <div id="members-grid" class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    <!-- Dynamic Content Will Be Injected Here -->
                </div>
            </div>

            <!-- BOTTOM ACTION BAR -->
            <div class="p-4 bg-slate-950/90 border-t border-white/5 shrink-0 backdrop-blur-md flex flex-col gap-3">
                
                <!-- Drink Selector (Horizontal Scroll) -->
                <div>
                     <div class="flex justify-between items-center mb-2">
                        <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest flex items-center gap-1">
                            <i class="fa-solid fa-wine-glass"></i> Select Gift (é€‰æ‹©é…’å“)
                        </label>
                        <span id="drink-price-display" class="text-xs font-mono text-amber-400"></span>
                     </div>
                     <div id="drink-selector" class="flex gap-3 overflow-x-auto no-scrollbar pb-1">
                        <!-- Dynamic Drink Options -->
                     </div>
                </div>

                <!-- Action Button & Summary -->
                <div class="flex items-center gap-4">
                    <div class="flex-1">
                         <div onclick="goToConfirmation()" id="gift-btn" class="cursor-pointer w-full h-14 rounded-xl btn-enabled text-white font-bold text-base tracking-wide shadow-[0_0_20px_rgba(236,72,153,0.5)] transform transition-transform hover:scale-[1.01] flex items-center justify-center gap-3 active:scale-95 group relative overflow-hidden opacity-50 pointer-events-none grayscale">
                            <div class="absolute inset-0 bg-white/20 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700 ease-in-out"></div>
                            <span class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center shadow-inner"><i class="fa-solid fa-gift animate-bounce text-sm"></i></span>
                            <div class="flex flex-col items-start leading-none">
                                <span class="text-sm">ç¡®è®¤èµ é€</span>
                                <span class="text-[9px] font-normal opacity-90">Send Gift</span>
                            </div>
                            <!-- Price Tag on Button -->
                            <div class="ml-auto mr-4 text-right">
                                <span class="block font-mono text-lg leading-none" id="total-price">Â¥ 0</span>
                                <span class="text-[9px] font-normal opacity-80" id="selection-count-label">0 chosen</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // Data Structure: Grouped by Tables & Drink Options
        const tribes = {
            poetic: {
                color: 'violet',
                title: 'å¾®é†ºè¯—äºº',
                icon: 'fa-feather-pointed',
                bgClass: 'bg-violet-900/30',
                drinks: [
                    { id: 'pd1', name: 'ç‰¹è°ƒÂ·æœˆå…‰ (Moonlight)', price: 48, icon: 'fa-martini-glass' },
                    { id: 'pd2', name: 'è‹¦è‰¾é…’ (Absinthe)', price: 68, icon: 'fa-cannabis' },
                    { id: 'pd3', name: 'çº¢é…’ (House Wine)', price: 42, icon: 'fa-wine-glass' },
                    { id: 'pd4', name: 'è¯—äººä¹‹è¡€ (Poet\'s Blood)', price: 55, icon: 'fa-droplet' },
                    { id: 'pd5', name: 'æ˜Ÿç©º (Starry Night)', price: 62, icon: 'fa-star' }
                ],
                tables: [
                    {
                        name: "Table A1",
                        id: "t-poetic-1",
                        members: [
                            {id: 'p1', name: 'Luna', img: 'Luna', status: 'å†™è¯—ä¸­ âœï¸'},
                            {id: 'p2', name: 'Jasper', img: 'Jasper', status: 'çµæ„Ÿ ğŸ·'}
                        ]
                    },
                    {
                        name: "Table A2",
                        id: "t-poetic-2",
                        members: [
                            {id: 'p3', name: 'Echo', img: 'Echo', status: 'ä½åŸ ğŸµ'},
                            {id: 'p4', name: 'Frost', img: 'Frost', status: 'å¤œè‰² ğŸŒ™'},
                            {id: 'p5', name: 'Muse', img: 'Muse', status: 'è®°å½• ğŸ“–'}
                        ]
                    }
                ]
            },
            electro: {
                color: 'rose',
                title: 'ç‡¥çƒ­ç”µéŸ³',
                icon: 'fa-bolt',
                bgClass: 'bg-rose-900/30',
                drinks: [
                     { id: 'ed1', name: 'é‡æ ¼ç‚¸å¼¹ (Jager Bomb)', price: 58, icon: 'fa-bomb' },
                     { id: 'ed2', name: 'é‡‘æ±¤åŠ› (Gin Tonic)', price: 48, icon: 'fa-glass-water' },
                     { id: 'ed3', name: 'Shot Tray (6 cups)', price: 188, icon: 'fa-glass-water-droplet' },
                     { id: 'ed4', name: 'ä¼ç‰¹åŠ çº¢ç‰› (Vodka Redbull)', price: 52, icon: 'fa-bull' },
                     { id: 'ed5', name: 'é•¿å²›å†°èŒ¶ (Long Island)', price: 65, icon: 'fa-glass-citrus' }
                ],
                tables: [
                    {
                        name: "DJ èˆæ± ",
                        id: "t-electro-1",
                        members: [
                            {id: 'e1', name: 'Vibe', img: 'Vibe', status: 'Raving ğŸ•º'},
                            {id: 'e2', name: 'Neon', img: 'Neon', status: 'æ‰“ç¢Ÿ ğŸ§'}
                        ]
                    },
                    {
                        name: "Bar",
                        id: "t-electro-2",
                        members: [
                            {id: 'e3', name: 'Rex', img: 'Rex', status: 'èˆä¼´ ğŸ’ƒ'},
                            {id: 'e4', name: 'Zoe', img: 'Zoe', status: 'Energy âš¡'}
                        ]
                    }
                ]
            },
            whisper: {
                color: 'amber',
                title: 'å•†åŠ¡æ´½è°ˆ',
                icon: 'fa-handshake',
                bgClass: 'bg-amber-900/30',
                drinks: [
                    { id: 'wd1', name: 'å•ä¸€éº¦èŠ½ (Single Malt)', price: 128, icon: 'fa-whiskey-glass' },
                    { id: 'wd2', name: 'å¹²é‚‘ (Cognac)', price: 158, icon: 'fa-wine-glass-empty'},
                    { id: 'wd3', name: 'å·´é»æ°´ (Perrier)', price: 38, icon: 'fa-bottle-water'},
                    { id: 'wd4', name: 'é©¬æå°¼ (Dry Martini)', price: 88, icon: 'fa-martini-glass-citrus'},
                    { id: 'wd5', name: 'æ™®æ´±èŒ¶ (Aged Puer)', price: 68, icon: 'fa-mug-hot'}
                ],
                tables: [
                    {
                        name: "VIP 888",
                        id: "t-whisper-1",
                        members: [
                            {id: 'w1', name: 'Boss', img: 'Boss', status: 'æ´½è°ˆ ğŸ’¼'},
                            {id: 'w2', name: 'Jean', img: 'Jean', status: 'é™å¬ ğŸ¤”'}
                        ]
                    },
                    {
                        name: "Lobby B",
                        id: "t-whisper-2",
                        members: [
                            {id: 'w3', name: 'Hanks', img: 'Hanks', status: 'åç‰‡ ğŸ¤'},
                            {id: 'w4', name: 'Ivy', img: 'Ivy', status: 'è®°å½• ğŸ“'}
                        ]
                    }
                ]
            },
            solo: {
                color: 'cyan',
                title: 'ç‹¬è‡ªæ”¾ç©º',
                icon: 'fa-wind',
                bgClass: 'bg-cyan-900/30',
                drinks: [
                    { id: 'sd1', name: 'çƒ­çº¢é…’ (Mulled Wine)', price: 45, icon: 'fa-mug-hot'},
                    { id: 'sd2', name: 'çƒ­æ‰˜è¿ª (Hot Toddy)', price: 42, icon: 'fa-mug-saucer'},
                    { id: 'sd3', name: 'ä¹Œé¾™èŒ¶ (Oolong)', price: 32, icon: 'fa-leaf'},
                    { id: 'sd4', name: 'æ— é…’ç²¾è«å‰æ‰˜ (Virgin Mojito)', price: 38, icon: 'fa-lemon'},
                    { id: 'sd5', name: 'ä¾äº‘ (Evian)', price: 28, icon: 'fa-bottle-droplet'}
                ],
                tables: [
                    {
                        name: "Bar Area",
                        id: "t-solo-1",
                        members: [
                            {id: 's1', name: 'Ghost', img: 'Ghost', status: 'æ”¾ç©º ğŸ˜¶'},
                            {id: 's2', name: 'Cloud', img: 'Cloud', status: 'å‘å‘† â˜ï¸'}
                        ]
                    },
                    {
                        name: "Terrace",
                        id: "t-solo-2",
                        members: [
                            {id: 's3', name: 'Blue', img: 'Blue', status: 'å¬æ­Œ ğŸ§'},
                            {id: 's4', name: 'Rain', img: 'Rain', status: 'çœ‹é›¨ ğŸŒ§ï¸'}
                        ]
                    }
                ]
            }
        };

        let currentTribeKey = 'poetic';
        let selectedDrinkIds = new Set();
        let selectedMemberIds = new Set();
        let feedInterval;

        function selectTribe(key) {
            currentTribeKey = key;
            const data = tribes[key];
            
            // Clear Selection UI
            selectedMemberIds.clear();
            
            // Default Drink Selection (Select first one)
            selectedDrinkIds.clear();
            if(data.drinks.length > 0) {
                selectedDrinkIds.add(data.drinks[0].id);
            }

            // 1. Update Left Selection UI
            document.querySelectorAll('[id^="tribe-"]').forEach(el => {
                el.classList.remove('tribe-selected');
                el.classList.add('opacity-60', 'scale-95');
                el.querySelector('.effect-container').style.opacity = '0.5';
            });
            const activeEl = document.getElementById(`tribe-${key}`);
            activeEl.classList.add('tribe-selected');
            activeEl.classList.remove('opacity-60', 'scale-95');
            activeEl.querySelector('.effect-container').style.opacity = '1';

            // 2. Update Header
            document.getElementById('right-header-bg').className = `h-32 relative flex items-center px-8 transition-colors duration-500 ${data.bgClass}`;
            document.getElementById('header-title').innerText = data.title;
            const iconContainer = document.getElementById('header-icon-container');
            iconContainer.className = `w-10 h-10 rounded-full flex items-center justify-center text-slate-900 shadow-lg transition-colors duration-300 bg-${data.color}-500 shadow-${data.color}-500/50`;
            document.getElementById('header-icon').className = `fa-solid ${data.icon} text-lg`;

            // 3. Render Content
            renderTables(data.tables, data.color);
            renderDrinks(data.drinks, data.color);
            updateSelectionUI();

            // 4. Feed
            const allUsers = data.tables.flatMap(t => t.members);
            startFeed(allUsers);
        }

        // --- Render Functions ---

        function renderDrinks(drinks, color) {
            const container = document.getElementById('drink-selector');
            container.innerHTML = drinks.map(d => {
                const isSelected = selectedDrinkIds.has(d.id);
                // Multi-select style
                const activeClass = isSelected ? `bg-slate-700/90 border-${color}-400 ring-2 ring-${color}-400/50 shadow-lg shadow-${color}-500/20` : 'bg-slate-800/40 border-white/5 hover:bg-slate-700/40 opacity-80 hover:opacity-100';
                
                return `
                <div onclick="toggleDrink('${d.id}')" class="shrink-0 cursor-pointer rounded-lg border p-2 flex items-center gap-2 pr-4 transition-all ${activeClass} select-none">
                    <div class="w-8 h-8 rounded-md bg-black/20 flex items-center justify-center text-${color}-400 relative">
                        <i class="fa-solid ${d.icon}"></i>
                        ${isSelected ? `<div class="absolute -top-1 -right-1 w-3 h-3 bg-${color}-500 rounded-full border border-slate-900"></div>` : ''}
                    </div>
                    <div class="flex flex-col">
                        <span class="text-xs font-bold text-slate-200">${d.name}</span>
                        <span class="text-[10px] text-slate-500 font-mono">Â¥${d.price}</span>
                    </div>
                </div>`;
            }).join('');
        }

        function renderTables(tables, color) {
            const container = document.getElementById('members-grid');
            container.innerHTML = '';
            // Grid Layout for 200px wide table cards
            container.className = "grid grid-cols-2 md:grid-cols-3 gap-4 pb-2"; 

            tables.forEach((table) => {
                // Each table shows up to 3 users
                const displayMembers = table.members.slice(0, 3);
                if (displayMembers.length === 0) return;
                
                // Check if all members in table are selected
                const allSelected = displayMembers.every(m => selectedMemberIds.has(m.id));
                const someSelected = displayMembers.some(m => selectedMemberIds.has(m.id));
                const tableSelectedClass = allSelected ? `ring-2 ring-${color}-400` : (someSelected ? `ring-1 ring-${color}-400/50` : '');
                
                // Generate member items HTML
                const memberItems = displayMembers.map(u => {
                    const isSelected = selectedMemberIds.has(u.id);
                    const memberSelectedClass = isSelected ? `bg-${color}-600/80` : 'bg-slate-700/60';
                    const checkIcon = isSelected ? `<span class="text-${color}-200 text-xs">âœ“</span>` : `<span class="text-slate-400 text-xs">â—‹</span>`;
                    
                    return `
                        <div onclick="event.stopPropagation(); toggleMember('${u.id}', '${table.id}')" 
                             class="${memberSelectedClass} hover:bg-${color}-500/80 rounded-full px-2 py-0.5 flex items-center gap-1 cursor-pointer transition-all">
                            ${checkIcon}
                            <span class="text-white text-xs font-medium truncate max-w-[60px]">${u.name}</span>
                        </div>
                    `;
                });
                
                // If 3+ members, split into 2 rows (2 on first row, rest on second)
                let membersHTML = '';
                if (displayMembers.length >= 3) {
                    membersHTML = `
                        <div class="flex gap-1 justify-center flex-wrap">
                            ${memberItems.slice(0, 2).join('')}
                        </div>
                        <div class="flex gap-1 justify-center flex-wrap">
                            ${memberItems.slice(2).join('')}
                        </div>
                    `;
                } else {
                    membersHTML = `
                        <div class="flex gap-1 justify-center flex-wrap">
                            ${memberItems.join('')}
                        </div>
                    `;
                }
                
                // Table Card: 200px wide with chair icon, table name, and users
                container.innerHTML += `
                    <div id="table-card-${table.id}" 
                         class="bg-slate-900/60 border-slate-700/50 ${tableSelectedClass} hover:bg-slate-800/90 border rounded-2xl transition-all group relative overflow-hidden flex flex-col items-center justify-between py-3 px-2" 
                         style="width: 200px; min-height: 160px;">
                        
                        <!-- Header: Chair Icon + Select All -->
                        <div class="flex items-center justify-between w-full px-1">
                            <div class="table-icon text-2xl">ğŸª‘</div>
                            <div onclick="toggleTable('${table.id}')" 
                                 class="text-xs text-slate-400 hover:text-white cursor-pointer px-2 py-0.5 rounded hover:bg-white/10 transition-colors"
                                 title="é€‰æ‹©å…¨æ¡Œ">
                                ${allSelected ? 'âœ“å…¨é€‰' : 'å…¨é€‰'}
                            </div>
                        </div>
                        
                        <!-- Table Name -->
                        <div class="text-base font-bold text-white">
                            ${table.name}
                        </div>
                        
                        <!-- Users List -->
                        <div class="flex flex-col gap-1 w-full items-center">
                            ${membersHTML}
                        </div>
                    </div>
                `;
            });
        }

        // --- Interaction Logic ---

        function toggleDrink(drinkId) {
            const data = tribes[currentTribeKey];
            if(selectedDrinkIds.has(drinkId)) {
                // Allow deselecting, but keep at least one? Or allow 0? 
                // Let's allow 0 for full flexibility, but button should be disabled if 0 drinks OR 0 people
                selectedDrinkIds.delete(drinkId);
            } else {
                selectedDrinkIds.add(drinkId);
            }
            renderDrinks(data.drinks, data.color);
            updateSelectionUI();
        }

        function toggleMember(memberId, tableId) {
            if (selectedMemberIds.has(memberId)) {
                selectedMemberIds.delete(memberId);
            } else {
                selectedMemberIds.add(memberId);
            }
            // Re-render tables to update UI
            const data = tribes[currentTribeKey];
            renderTables(data.tables, data.color);
            updateSelectionUI();
        }

        function toggleTable(tableId) {
            const data = tribes[currentTribeKey];
            const table = data.tables.find(t => t.id === tableId);
            if (!table) return;
            
            // Check if all members are currently selected
            const displayMembers = table.members.slice(0, 3);
            const allSelected = displayMembers.every(m => selectedMemberIds.has(m.id));
            
            // Toggle: if all selected, deselect all; otherwise select all
            displayMembers.forEach(m => {
                if (allSelected) {
                    selectedMemberIds.delete(m.id);
                } else {
                    selectedMemberIds.add(m.id);
                }
            });
            
            // Re-render tables to update UI
            renderTables(data.tables, data.color);
            updateSelectionUI();
        }

        function syncTableCheckboxes() {
            // No longer needed with new layout, but keep for compatibility
        }

        function updateCardStyle(memberId) {
            // Style is now handled by re-rendering in toggleMember
            // This function is kept for compatibility
        }

        function updateSelectionUI() {
            const memberCount = selectedMemberIds.size;
            
            // Calculate Total Price
            const data = tribes[currentTribeKey];
            let drinkTotal = 0;
            
            data.drinks.forEach(d => {
                if(selectedDrinkIds.has(d.id)) {
                    drinkTotal += d.price;
                }
            });
            
            const finalPrice = memberCount * drinkTotal;
            
            // Update UI Elements
            const totalEl = document.getElementById('total-price');
            const countLabel = document.getElementById('selection-count-label');
            const btn = document.getElementById('gift-btn');
            const drinkPriceLabel = document.getElementById('drink-price-display');

            totalEl.innerHTML = `Â¥ <span class="text-2xl">${finalPrice}</span>`;
            countLabel.innerText = `${memberCount} people`;
            
            const drinkCount = selectedDrinkIds.size;
            if(drinkCount > 0) {
                 drinkPriceLabel.innerText = `${drinkCount} items (Â¥${drinkTotal}/head)`;
            } else {
                 drinkPriceLabel.innerText = `Select drinks`;
            }

            if (memberCount > 0 && drinkCount > 0) {
                btn.classList.remove('opacity-50', 'pointer-events-none', 'grayscale');
                btn.querySelector('span.text-sm').innerText = `èµ é€ ${drinkCount} æ¬¾ç»™ ${memberCount} ä½`;
            } else {
                btn.classList.add('opacity-50', 'pointer-events-none', 'grayscale');
                if(memberCount === 0) btn.querySelector('span.text-sm').innerText = `è¯·é€‰æ‹©å¥½å‹`;
                else if(drinkCount === 0) btn.querySelector('span.text-sm').innerText = `è¯·é€‰æ‹©é…’å“`;
                else btn.querySelector('span.text-sm').innerText = `ç¡®è®¤èµ é€`;
            }
        }

        function startFeed(users) {
            if(feedInterval) clearInterval(feedInterval);
            const feedEl = document.getElementById('live-feed-text');
            const actions = ['åŠ å…¥äº†å°ç»„', 'é€å‡ºäº†ç¤¼ç‰© ğŸ', 'ç‚¹äº†ä¸€é¦–çˆµå£«ä¹ ğŸµ', 'æ­£åœ¨å“å°ç‰¹è°ƒ ğŸ¸', 'æŸ¥çœ‹äº†ä½ çš„ä¸»é¡µ', 'ç‚¹èµäº†å…¨åœº'];
            
            feedInterval = setInterval(() => {
                const randomUser = users[Math.floor(Math.random() * users.length)].name;
                const randomAction = actions[Math.floor(Math.random() * actions.length)];
                feedEl.style.opacity = '0'; 
                setTimeout(() => {
                    feedEl.innerText = `${randomUser} ${randomAction}`;
                    feedEl.style.opacity = '1';
                }, 300);
            }, 3000);
        }

        function goToConfirmation() {
            const data = tribes[currentTribeKey];
            const selectedDrinks = data.drinks.filter(d => selectedDrinkIds.has(d.id));
            
            // Analyze Selected Members for "Table" Logic
            let recipientName = "";
            let recipientType = "single"; // single, group, multi
            let recipientCount = selectedMemberIds.size;
            
            const selectedTables = [];
            data.tables.forEach(table => {
                const allMembersSelected = table.members.every(m => selectedMemberIds.has(m.id));
                if (allMembersSelected) {
                    selectedTables.push(table.name);
                }
            });

            if (selectedTables.length > 0) {
                // If tables are selected
                recipientType = selectedTables.length > 1 ? "multi" : "group";
                recipientName = selectedTables.join(" & ");
            } else {
                if (recipientCount === 1) {
                     recipientType = "single";
                     // Find the name
                     for(let t of data.tables) {
                         const found = t.members.find(m => selectedMemberIds.has(m.id));
                         if(found) { recipientName = found.name; break; }
                     }
                } else {
                    recipientType = "multi";
                    recipientName = `${recipientCount}ä½å¥½å‹`;
                }
            }

            // Calculate Total
            const drinkCostPerPerson = selectedDrinks.reduce((sum, d) => sum + d.price, 0);
            const grandTotal = drinkCostPerPerson * recipientCount;

            const payload = {
                tribeTitle: data.title,
                tribeColor: data.color,
                recipient: {
                    name: recipientName,
                    type: recipientType,
                    count: recipientCount,
                    // Pass specific member images if needed for single view
                    members: [] // Could populate for thumbnails
                },
                items: selectedDrinks,
                total: grandTotal
            };

            // Store and Navigate
            localStorage.setItem('giftData', JSON.stringify(payload));
            window.location.href = '5.html';
        }

        // Init
        selectTribe('poetic');

        
    </script>
</body>
</html>