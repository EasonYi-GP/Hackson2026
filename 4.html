<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flavor Tribes</title>
    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Noto+Serif+SC:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Noto Serif SC', 'serif'],
                        display: ['Playfair Display', 'serif'],
                    },
                    colors: {
                        'fresh-base': '#10b981',
                        'creamy-base': '#f59e0b',
                        'hardcore-base': '#e11d48',
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'bubble-rise': 'rise 4s infinite ease-in',
                        'ember-fly': 'fly 3s infinite linear',
                        'liquid-sway': 'sway 8s infinite ease-in-out',
                        'pulse-glow': 'pulseGlow 2s infinite',
                    },
                    keyframes: {
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } },
                        rise: { '0%': { bottom: '-30px', opacity: 0, transform: 'translateX(0)' }, '20%': {opacity: 0.8}, '100%': { bottom: '150%', opacity: 0, transform: 'translateX(-20px)' } },
                        fly: { '0%': { transform: 'translateY(0) translateX(0) scale(1)', opacity: 1 }, '100%': { transform: 'translateY(-150px) translateX(30px) scale(0)', opacity: 0 } },
                        sway: { '0%, 100%': { transform: 'rotate(-3deg) scale(1.1)' }, '50%': { transform: 'rotate(3deg) scale(1)' } },
                        pulseGlow: { '0%, 100%': { boxShadow: '0 0 10px currentColor' }, '50%': { boxShadow: '0 0 30px currentColor, 0 0 50px currentColor' } }
                    }
                }
            }
        }
    </script>
    <style>
        /* å…¨å±€éšè—æ‰€æœ‰æ»šåŠ¨æ¡ */
        * {
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE and Edge */
        }
        *::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
            width: 0;
            height: 0;
        }

        body { font-family: 'Inter', sans-serif; }
        .serif-font { font-family: 'Noto Serif SC', serif; }
        
        /* Vertical text for stage */
        .vertical-text {
            writing-mode: vertical-rl;
            text-orientation: mixed;
        }

        .hide-scroll::-webkit-scrollbar { width: 4px; }
        .hide-scroll::-webkit-scrollbar-track { background: transparent; }
        .hide-scroll::-webkit-scrollbar-thumb { background: #334155; border-radius: 2px; }

        /* æ·±æ¸ŠèƒŒæ™¯ */
        .abyssal-bg {
            background-color: #020617;
            background-image:
                radial-gradient(circle at 15% 50%, rgba(30, 27, 75, 0.4) 0%, transparent 25%),
                radial-gradient(circle at 85% 30%, rgba(15, 23, 42, 0.6) 0%, transparent 25%);
            min-height: 100vh;
        }

        /* ç»ç’ƒé¢æ¿ */
        .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.03);
            border-radius: 20px;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .effect-container { position: absolute; inset: 0; overflow: hidden; border-radius: inherit; pointer-events: none; }
        
        /* å¢å¼ºçš„åŠ¨æ•ˆå…ƒç´  */
        .bubble { 
            position: absolute; 
            background: rgba(255,255,255,0.6); 
            border-radius: 50%; 
            box-shadow: 0 0 5px rgba(255,255,255,0.4);
        }
        .ember { 
            position: absolute; 
            width: 4px; 
            height: 4px; 
            background: #fca5a5; 
            border-radius: 50%; 
            box-shadow: 0 0 8px #ef4444, 0 0 12px #ef4444; 
        }
        
        .tribe-selected {
            border: 3px solid rgba(255,255,255,0.9) !important;
            box-shadow: 0 0 20px rgba(255,255,255,0.3), 0 10px 30px -10px rgba(0,0,0,0.8) !important;
            z-index: 10;
        }

        .btn-enabled {
            background: linear-gradient(90deg, #ec4899, #f43f5e, #fbbf24);
            background-size: 200% 200%;
            animation: gradientMove 3s ease infinite;
        }
        @keyframes gradientMove { 
            0% { background-position: 0% 50% } 
            50% { background-position: 100% 50% } 
            100% { background-position: 0% 50% } 
        }

        /* Dynamic Background */
        .mystic-bg {
            background-color: #020617;
            background-image:
                radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%),
                radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%),
                radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%);
            position: absolute; inset: 0; z-index: -1;
        }

        
            50% { opacity: 0.95; transform: translateY(-50vh) translateX(var(--drift)); }
            95% { opacity: 0.8; }
            100% { transform: translateY(-100vh) translateX(calc(var(--drift) * 1.5)); opacity: 0; }
        }
    </style>
</head>
<body class="text-slate-200 min-h-screen relative font-sans overflow-x-hidden">

    <div class="mystic-bg"></div>
    <!-- Main Content -->
    <div class="relative z-10 flex flex-col md:flex-row min-h-screen p-2 md:p-4 gap-2 max-w-7xl mx-auto">

        <!-- å·¦ä¾§å¯¼èˆªæ  -->
        <aside class="glass-panel w-full lg:w-64 flex flex-col p-6 shadow-2xl shrink-0 lg:h-[calc(100vh-3rem)] lg:sticky lg:top-6">
            <div class="mb-8 flex lg:block items-center justify-between">
                <div>
                    <p class="text-[10px] text-amber-700/80 tracking-[0.3em] font-bold">EST. 2026</p>
                    <h1 class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-br from-amber-100 to-amber-600 serif-font mt-1">
                        åŠæ¯è¯—ç¤¾
                    </h1>
                </div>
                <button class="lg:hidden text-slate-400">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                    </svg>
                </button>
            </div>

            <!-- å¯¼èˆªèœå• -->
            <nav class="hidden lg:flex flex-col gap-2 flex-1">
                <a href="1.html" class="flex items-center gap-3 px-4 py-3 text-slate-500 hover:text-slate-300 hover:bg-white/5 rounded-xl transition-all group">
                    <svg class="w-5 h-5 group-hover:text-amber-500/50 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                    </svg>
                    <span>å¤§å… Hall</span>
                </a>
                <a href="2.html" class="flex items-center gap-3 px-4 py-3 text-slate-500 hover:text-slate-300 hover:bg-white/5 rounded-xl transition-all group">
                    <svg class="w-5 h-5 group-hover:text-amber-500/50 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                    </svg>
                    <span>æ–°äººå‘å¯¼ Guide</span>
                </a>
                <a href="3.html" class="flex items-center gap-3 px-4 py-3 text-slate-500 hover:text-slate-300 hover:bg-white/5 rounded-xl transition-all group">
                    <svg class="w-5 h-5 group-hover:text-amber-500/50 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
                    </svg>
                    <span>å¾®é†ºä¼šè¯ Session</span>
                </a>
                <a href="4.html" class="flex items-center gap-3 px-4 py-3 bg-white/5 text-amber-50 rounded-xl border border-white/5 font-medium transition-all group">
                    <svg class="w-5 h-5 text-amber-500/80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                    </svg>
                    <span>åœˆå­ Circles</span>
                </a>
                <a href="6.html" class="flex items-center gap-3 px-4 py-3 text-slate-500 hover:text-slate-300 hover:bg-white/5 rounded-xl transition-all group">
                    <svg class="w-5 h-5 group-hover:text-amber-500/50 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    <span>æˆ‘çš„æ¡£æ¡ˆ Profile</span>
                </a>
            </nav>

            <!-- ç”¨æˆ·ä¿¡æ¯ -->
            <div class="hidden lg:flex mt-auto pt-6 border-t border-white/5 items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-amber-900/30 border border-amber-500/20 flex items-center justify-center text-amber-500 font-bold text-xs ring-4 ring-black">
                    ME
                </div>
                <div>
                    <p class="text-sm text-amber-500/80 font-bold">é…’å®¢ #0608</p>
                    <p class="text-[10px] text-slate-500">å¾®é†ºæ¢é™©å®¶</p>
                </div>
            </div>
        </aside>

        <!-- LEFT COLUMN: TRIBE SELECTOR -->
        <div class="w-full md:w-48 flex flex-col gap-1.5 shrink-0 md:max-h-[calc(100vh-2rem)] md:overflow-y-auto px-0.5 py-1">
            <header class="mb-0.5 shrink-0">
                <h1 class="text-base font-bold italic tracking-wider text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-cyan-300">
                    é€‰æ‹©ä½ çš„é£å‘³é¢‘ç‡
                    <span class="block text-[9px] font-normal text-slate-400 not-italic mt-0.5">å¯»æ‰¾ä¸ä½ å‘³è•¾å…±é¸£çš„ä¼™ä¼´</span>
                </h1>
            </header>

            <!-- Card 1: Poetic (Violet) -->
            <div onclick="selectTribe('poetic')" id="tribe-poetic" class="relative group cursor-pointer h-20 rounded-2xl bg-violet-900/40 border border-violet-500/30 p-2 flex flex-col justify-end transition-all duration-300 overflow-hidden tribe-selected hover:border-violet-400/50">
                <div class="effect-container">
                    <div class="absolute inset-0 bg-gradient-to-t from-violet-900/90 via-transparent to-transparent"></div>
                    <div class="absolute top-0 right-0 w-full h-full opacity-30 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')]"></div>
                </div>
                
                <div class="relative z-10">
                    <div class="flex justify-between items-end">
                        <div class="space-y-0.5">
                            <div class="text-violet-300 font-mono text-[9px] mb-0.5 bg-violet-900/50 inline-block px-1 rounded">#çµæ„Ÿ #æœˆå…‰ #è¯—æ„</div>
                            <h2 class="text-lg font-bold text-white leading-none drop-shadow-lg">å¾®é†ºè¯—äºº</h2>
                            <p class="text-violet-100/70 text-[9px] mt-0.5 line-clamp-1">ç¬”å°–æµæ·Œçš„ä¸ä»…æ˜¯å¢¨æ°´ï¼Œè¿˜æœ‰æœˆå…‰ä¸é…’é¦™ã€‚</p>
                        </div>
                        <i class="fa-solid fa-feather-pointed text-xl text-violet-400 drop-shadow-[0_0_10px_rgba(167,139,250,0.5)] group-hover:scale-110 group-hover:-rotate-12 transition-transform"></i>
                    </div>
                </div>
            </div>

            <!-- Card 2: Electro (Rose) -->
            <div onclick="selectTribe('electro')" id="tribe-electro" class="relative group cursor-pointer h-20 rounded-2xl bg-rose-900/40 border border-rose-500/30 p-2 flex flex-col justify-end transition-all duration-300 overflow-hidden opacity-60 scale-95 hover:border-rose-400/50">
                <div class="effect-container">
                    <div class="ember left-[20%] top-[90%] animate-ember-fly" style="animation-delay: 0.1s"></div>
                    <div class="ember left-[50%] top-[80%] animate-ember-fly" style="animation-delay: 0.5s"></div>
                    <div class="absolute inset-0 bg-gradient-to-t from-rose-900/90 via-transparent to-transparent"></div>
                </div>

                <div class="relative z-10">
                    <div class="flex justify-between items-end">
                        <div class="space-y-0.5">
                            <div class="text-rose-300 font-mono text-[9px] mb-0.5 bg-rose-900/50 inline-block px-1 rounded">#Rave #èƒ½é‡ #é‡Šæ”¾</div>
                            <h2 class="text-lg font-bold text-white leading-none drop-shadow-lg">ç‡¥çƒ­ç”µéŸ³</h2>
                            <p class="text-rose-100/70 text-[9px] mt-0.5 line-clamp-1">è·Ÿéšå¼ºåŠ²çš„å¾‹åŠ¨ï¼Œé‡Šæ”¾ä½“å†…æ‰€æœ‰çš„å¤šå·´èƒºã€‚</p>
                        </div>
                        <i class="fa-solid fa-bolt text-xl text-rose-500 drop-shadow-[0_0_15px_rgba(244,63,94,0.8)] group-hover:scale-110 transition-transform"></i>
                    </div>
                </div>
            </div>

            <!-- Card 3: Whisper (Amber) -->
            <div onclick="selectTribe('whisper')" id="tribe-whisper" class="relative group cursor-pointer h-20 rounded-2xl bg-amber-900/40 border border-amber-500/30 p-2 flex flex-col justify-end transition-all duration-300 overflow-hidden opacity-60 scale-95 hover:border-amber-400/50">
                <div class="effect-container">
                    <div class="absolute -bottom-1/2 -left-1/2 w-[200%] h-[200%] bg-amber-600/30 rounded-[40%] animate-liquid-sway filter blur-2xl opacity-60"></div>
                    <div class="absolute inset-0 bg-gradient-to-t from-amber-900/90 via-transparent to-transparent"></div>
                </div>

                <div class="relative z-10">
                    <div class="flex justify-between items-end">
                        <div class="space-y-0.5">
                            <div class="text-amber-300 font-mono text-[9px] mb-0.5 bg-amber-900/50 inline-block px-1 rounded">#æœºé‡ #åˆä½œ #è¿æ¥</div>
                            <h2 class="text-lg font-bold text-white leading-none drop-shadow-lg">å•†åŠ¡æ´½è°ˆ</h2>
                            <p class="text-amber-100/70 text-[9px] mt-0.5 line-clamp-1">åœ¨æ¯é…’ä¹‹é—´äº¤æ¢è§†é‡ï¼Œäºè°ˆç¬‘ä¹‹ä¸­è¾¾æˆå…±è¯†ã€‚</p>
                        </div>
                        <i class="fa-solid fa-handshake text-xl text-amber-400 drop-shadow-[0_0_10px_rgba(251,191,36,0.5)] group-hover:scale-110 transition-transform"></i>
                    </div>
                </div>
            </div>

            <!-- Card 4: Solo (Cyan) -->
            <div onclick="selectTribe('solo')" id="tribe-solo" class="relative group cursor-pointer h-20 rounded-2xl bg-cyan-900/40 border border-cyan-500/30 p-2 flex flex-col justify-end transition-all duration-300 overflow-hidden opacity-60 scale-95 hover:border-cyan-400/50">
                <div class="effect-container">
                    <div class="bubble w-2 h-2 left-[20%] animate-bubble-rise" style="animation-delay: 0s"></div>
                    <div class="bubble w-3 h-3 left-[70%] animate-bubble-rise" style="animation-delay: 0.5s"></div>
                    <div class="absolute inset-0 bg-gradient-to-t from-cyan-900/90 via-transparent to-transparent"></div>
                </div>

                <div class="relative z-10">
                    <div class="flex justify-between items-end">
                        <div class="space-y-0.5">
                            <div class="text-cyan-300 font-mono text-[9px] mb-0.5 bg-cyan-900/50 inline-block px-1 rounded">#ç‹¬å¤„ #ç™½å™ªéŸ³ #è‡ªåœ¨</div>
                            <h2 class="text-lg font-bold text-white leading-none drop-shadow-lg">ç‹¬è‡ªæ”¾ç©º</h2>
                            <p class="text-cyan-100/70 text-[9px] mt-0.5 line-clamp-1">äº«å—ä¸€ä¸ªäººçš„å®é™ï¼Œä¸ä¸–ç•Œä¿æŒå¾®é†ºçš„è·ç¦»ã€‚</p>
                        </div>
                        <i class="fa-solid fa-wind text-xl text-cyan-400 drop-shadow-[0_0_10px_rgba(34,211,238,0.5)] group-hover:scale-110 transition-transform"></i>
                    </div>
                </div>
            </div>

            <!-- Card 5: Gamer (Indigo) -->
            <div onclick="selectTribe('gamer')" id="tribe-gamer" class="relative group cursor-pointer h-20 rounded-2xl bg-indigo-900/40 border border-indigo-500/30 p-2 flex flex-col justify-end transition-all duration-300 overflow-hidden opacity-60 scale-95 hover:border-indigo-400/50">
                <div class="effect-container">
                    <div class="absolute inset-0 bg-gradient-to-t from-indigo-900/90 via-transparent to-transparent"></div>
                </div>

                <div class="relative z-10">
                    <div class="flex justify-between items-end">
                        <div class="space-y-0.5">
                            <div class="text-indigo-300 font-mono text-[9px] mb-0.5 bg-indigo-900/50 inline-block px-1 rounded">#å¼€é»‘ #ä¸Šåˆ† #ç«æŠ€</div>
                            <h2 class="text-lg font-bold text-white leading-none drop-shadow-lg">æ¸¸æˆäººç”Ÿ</h2>
                            <p class="text-indigo-100/70 text-[9px] mt-0.5 line-clamp-1">åœ¨è™šæ‹Ÿä¸–ç•Œä¸»å®°å…¨åœºï¼Œåœ¨ç°å®ç¢°æ¯åŒåº†ã€‚</p>
                        </div>
                        <i class="fa-solid fa-gamepad text-xl text-indigo-400 drop-shadow-[0_0_10px_rgba(129,140,248,0.5)] group-hover:scale-110 transition-transform"></i>
                    </div>
                </div>
            </div>

            <!-- Card 6: Foodie (Emerald) -->
            <div onclick="selectTribe('foodie')" id="tribe-foodie" class="relative group cursor-pointer h-20 rounded-2xl bg-emerald-900/40 border border-emerald-500/30 p-2 flex flex-col justify-end transition-all duration-300 overflow-hidden opacity-60 scale-95 hover:border-emerald-400/50">
                <div class="effect-container">
                    <div class="absolute inset-0 bg-gradient-to-t from-emerald-900/90 via-transparent to-transparent"></div>
                </div>

                <div class="relative z-10">
                    <div class="flex justify-between items-end">
                        <div class="space-y-0.5">
                            <div class="text-emerald-300 font-mono text-[9px] mb-0.5 bg-emerald-900/50 inline-block px-1 rounded">#æ¢åº— #å°é²œ #è€é¥•</div>
                            <h2 class="text-lg font-bold text-white leading-none drop-shadow-lg">ç¾é£Ÿæ¢åº—</h2>
                            <p class="text-emerald-100/70 text-[9px] mt-0.5 line-clamp-1">å”¯æœ‰ç¾é£Ÿä¸çˆ±ä¸å¯è¾œè´Ÿï¼Œå‘³è•¾çš„æè‡´æ¢ç´¢ã€‚</p>
                        </div>
                        <i class="fa-solid fa-utensils text-xl text-emerald-400 drop-shadow-[0_0_10px_rgba(52,211,153,0.5)] group-hover:scale-110 transition-transform"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- RIGHT COLUMN: MAIN WRAPPER -->
        <!-- Fixed Sticky Dashboard Layout on Desktop, Normal Flow on Mobile -->
        <div class="flex-1 flex flex-col gap-3 min-w-0 md:sticky md:top-4 md:h-[calc(100vh-2rem)]">
            
            <!-- BOTTOM: INTERACTION ZONE (Expanded to fill height) -->
            <div class="flex-1 flex flex-col bg-slate-900/60 backdrop-blur-xl rounded-2xl border border-white/10 shadow-2xl relative overflow-hidden">
            
            <!-- Top Bar with Activities -->
            <div id="right-header-bg" class="h-auto min-h-[5rem] py-3 relative flex items-center px-4 transition-colors duration-500 bg-amber-900/30 shrink-0 shadow-md">
                <div class="absolute inset-0 overflow-hidden pointer-events-none">
                    <div class="absolute -right-10 -top-10 w-64 h-64 bg-white/5 rounded-full blur-3xl"></div>
                </div>
                <div class="relative z-10 w-full">
                    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                        
                        <!-- Header Title & Stats -->
                        <div class="shrink-0 flex items-center gap-4">
                            <div class="flex items-center gap-3">
                                <span id="header-icon-container" class="w-10 h-10 shrink-0 rounded-full bg-amber-500 flex items-center justify-center text-slate-900 shadow-lg shadow-amber-500/50 transition-colors duration-300">
                                    <i id="header-icon" class="fa-solid fa-martini-glass-citrus text-lg"></i>
                                </span>
                                <div>
                                    <span class="text-lg font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-amber-200 via-yellow-300 to-orange-400 block leading-tight drop-shadow-lg animate-pulse">âœ¨ äº’åŠ¨ä¸“åŒº âœ¨</span>
                                    <div class="flex gap-3 text-[10px] font-mono opacity-70 text-slate-300 mt-0.5">
                                        <span id="total-people-count" class="flex items-center gap-1"><i class="fa-solid fa-user-group text-[9px]"></i> 0äººåœ¨æ¡Œ</span>
                                        <span class="flex items-center gap-1"><i class="fa-solid fa-signal text-green-400 text-[9px]"></i> çƒ­åº¦:é«˜</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- DYNAMIC ACTIVITIES LIST (Moved Here) -->
                        <div id="activity-container" class="flex-1 flex gap-2 overflow-x-auto no-scrollbar items-center md:justify-end md:max-w-2xl min-w-0"> 
                            <!-- JS Injected -->
                        </div>

                    </div>
                </div>
            </div>

            <!-- SPLIT BODY CONTENT -->
            <div class="flex-1 flex flex-row min-h-0 relative group/split">
                
                <!-- LEFT: Bar Floor Plan View - All Tables Overview -->
                <div class="flex-1 overflow-hidden p-1 no-scrollbar bg-gradient-to-b from-slate-900/50 to-slate-950/50 relative">
                    <!-- Bar Floor Plan - Realistic Layout -->
                    <div id="bar-floor-plan" class="relative w-full h-full min-h-[320px]">
                        <!-- Bar Counter at Top -->
                        <div class="absolute top-1 left-1/2 -translate-x-1/2 w-[35%] h-12 bg-gradient-to-b from-amber-900/60 to-amber-950/40 rounded-b-xl border-b border-x border-amber-600/30 flex items-center justify-center gap-1 shadow-md z-30">
                            <i class="fa-solid fa-wine-bottle text-amber-500/60 text-[10px]"></i>
                            <span class="text-[10px] text-amber-400/80 font-bold">BAR</span>
                            <i class="fa-solid fa-champagne-glasses text-amber-500/60 text-[10px]"></i>
                        </div>
                        
                        <!-- Stage at Left Side -->
                        <div class="absolute left-1 top-1/2 -translate-y-1/2 w-16 h-[70%] rounded-r-xl bg-gradient-to-r from-purple-900/80 to-indigo-900/60 border-r border-y border-purple-500/50 flex flex-col items-center justify-center gap-2 shadow-lg shadow-purple-500/40 z-30">
                            <i class="fa-solid fa-microphone-lines text-purple-400 text-[14px]"></i>
                            <span class="text-[10px] text-purple-300 font-bold tracking-wider vertical-text">STAGE</span>
                            <i class="fa-solid fa-music text-purple-400 text-[14px] animate-pulse"></i>
                        </div>
                        
                        <!-- Tables Container - Right of stage -->
                        <div id="tables-container" class="absolute inset-0 pl-12 pt-8 z-10">
                            <!-- Dynamic Tables Will Be Injected Here -->
                        </div>
                        
                        <!-- Legend -->
                        <div id="floor-legend" class="absolute top-2 right-1 flex gap-1.5 text-[6px] text-slate-500 z-20">
                            <!-- Dynamic legend -->
                        </div>
                    </div>
                </div>

                <!-- RIGHT: Categorized Menu -->
                <div class="w-52 md:w-56 border-l border-white/5 bg-slate-900/50 backdrop-blur flex flex-col">
                    <!-- Categories Tabs -->
                    <div id="menu-categories" class="flex overflow-x-auto p-2 gap-1.5 border-b border-white/5 shrink-0 no-scrollbar bg-slate-950/20">
                        <!-- Injected JS -->
                    </div>
                    
                    <!-- Menu Header / Filter info could go here -->
                    
                    <!-- Scrollable Items List -->
                    <div id="menu-items-list" class="flex-1 overflow-y-auto p-2 gap-2 flex flex-col no-scrollbar">
                         <!-- Injected JS -->
                    </div>
                </div>

            </div>

            <!-- BOTTOM ACTION BAR -->
            <div class="p-2 px-3 pb-4 pt-4 bg-slate-950/90 border-t border-white/5 shrink-0 backdrop-blur-md z-20 shadow-[0_-5px_20px_rgba(0,0,0,0.3)] flex flex-col gap-2 mt-2">
                
                <!-- PREVIEW AREA -->
                <div id="selection-preview" class="hidden flex-col gap-1.5 p-1.5 bg-slate-900/50 rounded-lg border border-white/5">
                    <!-- Dynamic Content -->
                </div>

                <!-- Action Button Only -->
                <div class="flex items-center gap-3">
                    <div class="flex-1">
                         <div onclick="goToConfirmation()" id="gift-btn" class="cursor-pointer w-full h-12 rounded-xl btn-enabled text-white font-bold text-base tracking-wide shadow-[0_0_20px_rgba(236,72,153,0.5)] transform transition-transform hover:scale-[1.01] flex items-center justify-center gap-2 active:scale-95 group relative overflow-hidden opacity-50 pointer-events-none grayscale">
                            <div class="absolute inset-0 bg-white/20 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700 ease-in-out"></div>
                            <span class="w-7 h-7 rounded-full bg-white/20 flex items-center justify-center shadow-inner"><i class="fa-solid fa-gift animate-bounce text-xs"></i></span>
                            <div class="flex flex-col items-start leading-none">
                                <span class="text-xs">è¯·é€‰æ‹©å¥½å‹</span>
                                <span class="text-[8px] font-normal opacity-70" id="selection-count-label">0 people</span>
                            </div>
                            <!-- Price Tag on Button -->
                            <div class="ml-auto mr-3 text-right">
                                <span class="font-mono text-xl font-bold leading-none" id="total-price">Â¥ 0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        </div>
    </div>

    <script>
        // Data Structure: Grouped by Tables & Drink Options
        // Menu Categories
        const MENU_CATEGORIES = [
            { id: 'beer', name: 'å•¤é…’ (Beer)', icon: 'fa-beer-mug-empty' },
            { id: 'cocktail', name: 'é¸¡å°¾é…’ (Cocktail)', icon: 'fa-martini-glass-citrus' },
            { id: 'liquor', name: 'æ´‹é…’ (Liquor)', icon: 'fa-whiskey-glass' },
            { id: 'soft', name: 'è½¯é¥® (Soft)', icon: 'fa-glass-water' },
            { id: 'snack', name: 'å°é£Ÿ (Snack)', icon: 'fa-burger' }
        ];

        const allDrinks = [
             // Beer
             { id: 'b1', cat: 'beer', name: 'ç²¾é…¿ IPA', price: 58, icon: 'fa-beer-mug-empty' },
             { id: 'b2', cat: 'beer', name: 'æ¡‚èŠ±å°éº¦ (Osmanthus)', price: 48, icon: 'fa-wheat-awn' },
             { id: 'b3', cat: 'beer', name: 'ç§‘ç½—å¨œ (Corona)', price: 35, icon: 'fa-bottle-water' },
             { id: 'b4', cat: 'beer', name: 'ç¦ä½³ç™½ (Hoegaarden)', price: 35, icon: 'fa-beer-mug-empty' },
             { id: 'b5', cat: 'beer', name: '1664 Blanc', price: 38, icon: 'fa-bottle-droplet' }, 
             { id: 'b6', cat: 'beer', name: 'éº’éºŸç”Ÿå•¤ (Draft)', price: 30, icon: 'fa-beer-mug-empty' },
             { id: 'b7', cat: 'beer', name: 'é’å²›çº¯ç”Ÿ (Tsingtao)', price: 28, icon: 'fa-bottle-droplet' },
             { id: 'b8', cat: 'beer', name: 'æœæ—¥ (Asahi)', price: 30, icon: 'fa-beer-mug-empty'},
             { id: 'b9', cat: 'beer', name: 'ç²¾é…¿ä¸–æ¶› (Stout)', price: 68, icon: 'fa-beer-mug-empty' },
             { id: 'b10', cat: 'beer', name: 'ç™¾å¨ (Budweiser)', price: 30, icon: 'fa-beer-mug-empty' },
             { id: 'b11', cat: 'beer', name: 'ä¿®é“é™¢å•¤é…’ (Trappist)', price: 78, icon: 'fa-church' },
             { id: 'b12', cat: 'beer', name: 'ç™½ç†Š (Vedett)', price: 35, icon: 'fa-paw' },

             // Cocktails
             { id: 'c1', cat: 'cocktail', name: 'ç‰¹è°ƒÂ·æœˆå…‰ (Moonlight)', price: 48, icon: 'fa-martini-glass' },
             { id: 'c2', cat: 'cocktail', name: 'è¯—äººä¹‹è¡€ (Poet\'s Blood)', price: 55, icon: 'fa-droplet' },
             { id: 'c3', cat: 'cocktail', name: 'æ˜Ÿç©º (Starry Night)', price: 62, icon: 'fa-star' },
             { id: 'c4', cat: 'cocktail', name: 'é‡æ ¼ç‚¸å¼¹ (Jager Bomb)', price: 58, icon: 'fa-bomb' },
             { id: 'c5', cat: 'cocktail', name: 'é•¿å²›å†°èŒ¶ (Long Island)', price: 65, icon: 'fa-glass-citrus' },
             { id: 'c6', cat: 'cocktail', name: 'é©¬æå°¼ (Dry Martini)', price: 88, icon: 'fa-martini-glass-citrus'},
             { id: 'c7', cat: 'cocktail', name: 'è«å‰æ‰˜ (Mojito)', price: 48, icon: 'fa-leaf' },
             { id: 'c8', cat: 'cocktail', name: 'æ—¥å‡ºé¾™èˆŒå…° (Tequila Sunrise)', price: 52, icon: 'fa-sun' },
             { id: 'c9', cat: 'cocktail', name: 'é‡‘æ±¤åŠ› (Gin Tonic)', price: 45, icon: 'fa-lemon' },
             { id: 'c10', cat: 'cocktail', name: 'B-52 è½°ç‚¸æœº', price: 58, icon: 'fa-jet-fighter' },
             { id: 'c11', cat: 'cocktail', name: 'å°¼æ ¼ç½—å°¼ (Negroni)', price: 88, icon: 'fa-glass-citrus' },
             { id: 'c12', cat: 'cocktail', name: 'ä¼ç‰¹åŠ çº¢ç‰› (Vodka RedBull)', price: 52, icon: 'fa-bull' },
             { id: 'c13', cat: 'cocktail', name: 'æ›¼å“ˆé¡¿ (Manhattan)', price: 98, icon: 'fa-city' },

             // Liquor
             { id: 'l1', cat: 'liquor', name: 'è‹¦è‰¾é…’ (Absinthe)', price: 68, icon: 'fa-cannabis' },
             { id: 'l2', cat: 'liquor', name: 'çº¢é…’ (House Wine)', price: 42, icon: 'fa-wine-glass' },
             { id: 'l3', cat: 'liquor', name: 'Shot Tray (6 cups)', price: 188, icon: 'fa-glass-water-droplet' },
             { id: 'l4', cat: 'liquor', name: 'å•ä¸€éº¦èŠ½ (Single Malt)', price: 128, icon: 'fa-whiskey-glass' },
             { id: 'l5', cat: 'liquor', name: 'é»‘æ–¹ (Black Label)', price: 580, icon: 'fa-whiskey-glass' },
             { id: 'l6', cat: 'liquor', name: 'æ°å…‹ä¸¹å°¼ (Jack Daniels)', price: 480, icon: 'fa-wine-bottle' },
             { id: 'l7', cat: 'liquor', name: 'å¹²é‚‘ (Cognac)', price: 158, icon: 'fa-wine-glass-empty'},
             { id: 'l8', cat: 'liquor', name: 'èŒ…å° (Moutai)', price: 288, icon: 'fa-wine-bottle'},
             { id: 'l9', cat: 'liquor', name: 'é›ªè‰æ¡¶ (Sherry Cask)', price: 168, icon: 'fa-wine-glass' },
             { id: 'l10', cat: 'liquor', name: 'çš‡å®¶ç¤¼ç‚® (Royal Salute)', price: 888, icon: 'fa-crown' },
             { id: 'l11', cat: 'liquor', name: 'ç™¾åˆ©ç”œ (Baileys)', price: 48, icon: 'fa-glass-water' },
             { id: 'l12', cat: 'liquor', name: 'æ¢…å­é…’ (Plum)', price: 42, icon: 'fa-wine-bottle' },

             // Soft
             { id: 's1', cat: 'soft', name: 'çƒ­èŒ¶ (Hot Tea)', price: 28, icon: 'fa-mug-hot' },
             { id: 's2', cat: 'soft', name: 'å·´é»æ°´ (Perrier)', price: 38, icon: 'fa-bottle-water'},
             { id: 's3', cat: 'soft', name: 'çƒ­çº¢é…’ (Mulled Wine)', price: 45, icon: 'fa-mug-hot'},
             { id: 's4', cat: 'soft', name: 'æ©™æ± (Juice)', price: 32, icon: 'fa-glass-water' },
             { id: 's5', cat: 'soft', name: 'çƒ­ç‰›å¥¶ (Milk)', price: 28, icon: 'fa-mug-saucer' },
             { id: 's6', cat: 'soft', name: 'å¯ä¹ (Coke)', price: 25, icon: 'fa-bottle-droplet' },
             { id: 's7', cat: 'soft', name: 'çº¢ç‰› (Red Bull)', price: 28, icon: 'fa-bolt' },
             { id: 's8', cat: 'soft', name: 'è‹æ‰“æ°´ (Soda)', price: 20, icon: 'fa-glass-water' },
             { id: 's9', cat: 'soft', name: 'æ™®æ´±èŒ¶ (Aged Puer)', price: 68, icon: 'fa-mug-hot'},
             { id: 's10', cat: 'soft', name: 'ä¾äº‘çŸ¿æ³‰æ°´ (Evian)', price: 28, icon: 'fa-bottle-droplet'},
             { id: 's11', cat: 'soft', name: 'æ‰‹å†²å’–å•¡ (Hand Drip)', price: 58, icon: 'fa-mug-saucer'},
             { id: 's12', cat: 'soft', name: 'çƒ­æ‰˜è¿ª (Hot Toddy)', price: 42, icon: 'fa-mug-saucer'},
             { id: 's13', cat: 'soft', name: 'ä¹Œé¾™èŒ¶ (Oolong)', price: 32, icon: 'fa-leaf'},
             { id: 's14', cat: 'soft', name: 'æ°”æ³¡æ°´ (Sparkling)', price: 28, icon: 'fa-glass-water' },
             { id: 's15', cat: 'soft', name: 'é²œæ¦¨è‰è“æ± (Strawberry)', price: 38, icon: 'fa-glass-water' },
             
             // Snacks
             { id: 'f1', cat: 'snack', name: 'åšæœæ‹¼ç›˜ (Nuts)', price: 38, icon: 'fa-bowl-food' },
             { id: 'f2', cat: 'snack', name: 'é»‘å·§è›‹ç³• (Cake)', price: 45, icon: 'fa-cake-candles' },
             { id: 'f3', cat: 'snack', name: 'ç‚¸é¸¡å— (Fried Chicken)', price: 48, icon: 'fa-drumstick-bite' },
             { id: 'f4', cat: 'snack', name: 'è–¯æ¡ (Fries)', price: 32, icon: 'fa-utensils' },
             { id: 'f5', cat: 'snack', name: 'çˆ†ç±³èŠ± (Popcorn)', price: 28, icon: 'fa-bowl-rice' },
             { id: 'f6', cat: 'snack', name: 'è–¯ç‰‡ (Chips)', price: 22, icon: 'fa-cookie' },
             { id: 'f7', cat: 'snack', name: 'è¾£æ¡ (Spicy Strips)', price: 18, icon: 'fa-fire' },
             { id: 'f8', cat: 'snack', name: 'æ°´æœæ‹¼ç›˜ (Fruits)', price: 88, icon: 'fa-apple-whole'},
             { id: 'f9', cat: 'snack', name: 'è¥¿ç­ç‰™ç«è…¿ (Ham)', price: 128, icon: 'fa-bacon' },
             { id: 'f10', cat: 'snack', name: 'ç‚¸è–¯è§’ (Wedges)', price: 35, icon: 'fa-potato' },
             { id: 'f11', cat: 'snack', name: 'çƒŸç†ä¸‰æ–‡é±¼ (Salmon)', price: 98, icon: 'fa-fish' },
             { id: 'f12', cat: 'snack', name: 'æ‰‹æŒ‡é¥¼å¹² (Biscuits)', price: 22, icon: 'fa-cookie-bite' },
             { id: 'f13', cat: 'snack', name: 'è”¬èœæ¡ (Veggie Sticks)', price: 30, icon: 'fa-carrot' }
        ];

        // Data Structure
        const tribes = {
            poetic: {
                color: 'violet',
                title: 'å¾®é†ºè¯—äºº',
                icon: 'fa-feather-pointed',
                bgClass: 'bg-violet-900/30',
                activities: [
                    { name: "æœˆä¸‹è¯»è¯—ä¼š", date: "2024-02-14", time: "20:00", status: "Open" },
                    { name: "å¤ç´é›…é›†", date: "2024-02-15", time: "21:30", status: "Pending" },
                    { name: "å‰§æœ¬æ€Â·å¤œèˆªèˆ¹", date: "2024-02-16", time: "19:00", status: "Book" }
                ],
                drinks: allDrinks,
                tables: [
                    {
                        name: "è¯—äººé˜",
                        id: "t-poetic-1",
                        members: [
                            {id: 'p1', name: 'Luna', img: 'Luna', status: 'å†™è¯—ä¸­ âœï¸'},
                            {id: 'p2', name: 'Jasper', img: 'Jasper', status: 'çµæ„Ÿ ğŸ·'},
                            {id: 'p3', name: 'Ivy', img: 'Ivy', status: 'æ²‰æ€ ğŸŒ¿'},
                            {id: 'p4', name: 'Echo', img: 'Echo', status: 'ä½åŸ ğŸµ'}
                        ]
                    }
                ]
            },
            electro: {
                color: 'rose',
                title: 'ç‡¥çƒ­ç”µéŸ³',
                icon: 'fa-bolt',
                bgClass: 'bg-rose-900/30',
                activities: [
                    { name: "Alps æ»‘é›ªä¹‹æ—…", date: "2024-03-01", time: "All Day", status: "Booking" },
                    { name: "å®¤å†…æ”€å²©Â·æé€Ÿ", date: "2024-02-20", time: "18:00", status: "Open" },
                    { name: "Hundred DJ", date: "2024-02-12", time: "22:00", status: "Live" }
                ],
                drinks: allDrinks,
                tables: [
                    {
                        name: "ç”µéŸ³åŒº",
                        id: "t-electro-1",
                        members: [
                            {id: 'e1', name: 'Vibe', img: 'Vibe', status: 'Raving ğŸ•º'},
                            {id: 'e2', name: 'Neon', img: 'Neon', status: 'æ‰“ç¢Ÿ ğŸ§'},
                            {id: 'e3', name: 'Flash', img: 'Flash', status: 'è¹¦è¿ª ğŸ’¥'},
                            {id: 'e4', name: 'Bass', img: 'Bass', status: 'ä½éŸ³ ğŸ”Š'}
                        ]
                    }
                ]
            },
            whisper: {
                color: 'amber',
                title: 'å•†åŠ¡æ´½è°ˆ',
                icon: 'fa-handshake',
                bgClass: 'bg-amber-900/30',
                activities: [
                    { name: "ç²¾è‹±ç‹¼äººæ€", date: "2024-02-18", time: "20:00", status: "Open" },
                    { name: "è¡Œä¸šç§è‘£ä¼š", date: "2024-02-22", time: "19:00", status: "Invite" },
                    { name: "èµ„æºç½®æ¢é…’ä¼š", date: "2024-02-25", time: "20:00", status: "Pending" }
                ],
                drinks: allDrinks,
                tables: [
                    {
                        name: "VIPåŒ…å¢",
                        id: "t-whisper-1",
                        members: [
                            {id: 'w1', name: 'Boss', img: 'Boss', status: 'æ´½è°ˆ ğŸ’¼'},
                            {id: 'w2', name: 'Jean', img: 'Jean', status: 'é™å¬ ğŸ¤”'},
                            {id: 'w3', name: 'Mark', img: 'Mark', status: 'ç­¾çº¦ âœï¸'},
                            {id: 'w4', name: 'Lisa', img: 'Lisa', status: 'è°ˆåˆ¤ ğŸ’¬'}
                        ]
                    }
                ]
            },
            solo: {
                color: 'cyan',
                title: 'ç‹¬è‡ªæ”¾ç©º',
                icon: 'fa-wind',
                bgClass: 'bg-cyan-900/30',
                activities: [
                    { name: "å‘¨æœ«ç™»å±± (Hiking)", date: "2024-02-17", time: "08:00", status: "Join" },
                    { name: "ç™½å™ªéŸ³å†¥æƒ³", date: "Daily", time: "21:00", status: "Live" },
                    { name: "æ ‘æ´å€¾è¯‰å¤œ", date: "Every Night", time: "23:00", status: "Open" }
                ],
                drinks: allDrinks,
                tables: [
                    {
                        name: "é™è°§è§’",
                        id: "t-solo-1",
                        members: [
                            {id: 's1', name: 'Ghost', img: 'Ghost', status: 'æ”¾ç©º ğŸ˜¶'},
                            {id: 's2', name: 'Blue', img: 'Blue', status: 'å¬æ­Œ ğŸ§'},
                            {id: 's3', name: 'Rain', img: 'Rain', status: 'çœ‹é›¨ ğŸŒ§ï¸'}
                        ]
                    }
                ]
            },
            gamer: {
                color: 'indigo',
                title: 'æ¸¸æˆäººç”Ÿ',
                icon: 'fa-gamepad',
                bgClass: 'bg-indigo-900/30',
                activities: [
                    { name: "ç»„é˜Ÿå¼€é»‘", date: "Tonight", time: "20:00", status: "Open" },
                    { name: "æ¡Œæ¸¸ä¹‹å¤œ", date: "Weekly", time: "19:00", status: "Register" }
                ],
                drinks: allDrinks,
                tables: [
                    {
                        name: "æ¸¸æˆæ¡Œ",
                        id: "t-gamer-1",
                        members: [
                            {id: 'g1', name: 'Player1', img: 'P1', status: 'Rank Up ğŸ®'},
                            {id: 'g2', name: 'Player2', img: 'P2', status: 'Carry ğŸ†'},
                            {id: 'g3', name: 'Pro', img: 'Pro', status: 'å¼€é»‘ ğŸ¯'},
                            {id: 'g4', name: 'Ace', img: 'Ace', status: 'MVP ğŸ…'}
                        ]
                    }
                ]
            },
            foodie: {
                color: 'emerald',
                title: 'ç¾é£Ÿæ¢åº—',
                icon: 'fa-utensils',
                bgClass: 'bg-emerald-900/30',
                activities: [
                    { name: "æ–°èœå“é‰´ä¼š", date: "Sat", time: "18:00", status: "Invite" },
                    { name: "å¤§èƒƒç‹æŒ‘æˆ˜", date: "Sun", time: "14:00", status: "Live" }
                ],
                drinks: allDrinks,
                tables: [
                    {
                        name: "ç¾é£Ÿè§’",
                        id: "t-foodie-1",
                        members: [
                            {id: 'fd1', name: 'Chef', img: 'Chef1', status: 'Cooking ğŸ³'},
                            {id: 'fd2', name: 'Critic', img: 'Critic1', status: 'Tasting ğŸ·'},
                            {id: 'fd3', name: 'Foodie', img: 'Foodie', status: 'å“å° ğŸ˜‹'},
                            {id: 'fd4', name: 'Wine', img: 'Wine', status: 'é…é…’ ğŸ·'}
                        ]
                    }
                ]
            }
        };

        let currentTribeKey = 'poetic';
        let currentCategory = 'beer';
        let selectedDrinks = {}; // Object: { id: quantity }
        let selectedMemberIds = new Set();
        let feedInterval;

        function selectTribe(key) {
            currentTribeKey = key;
            const data = tribes[key];
            
            // Clear Selection UI
            selectedMemberIds.clear();
            
            // Default Drink Selection & Category
            selectedDrinks = {};
            currentCategory = 'beer'; // Default start

            if(data.drinks.length > 0) {
                 // Try to select one from current category if exists, else first available
                 const inCat = data.drinks.find(d => d.cat === currentCategory);
                 if(inCat) selectedDrinks[inCat.id] = 1;
                 else if(data.drinks.length > 0) selectedDrinks[data.drinks[0].id] = 1;
            }

            // 1. Update Left Selection UI
            document.querySelectorAll('[id^="tribe-"]').forEach(el => {
                el.classList.remove('tribe-selected');
                el.classList.add('opacity-60', 'scale-95');
                el.querySelector('.effect-container').style.opacity = '0.5';
            });
            const activeEl = document.getElementById(`tribe-${key}`);
            activeEl.classList.add('tribe-selected');
            activeEl.classList.remove('opacity-60', 'scale-95');
            activeEl.querySelector('.effect-container').style.opacity = '1';

            // 2. Update Header
            const headerBg = document.getElementById('right-header-bg');
            if(headerBg) headerBg.className = `h-auto min-h-[5rem] py-3 relative flex items-center px-4 transition-colors duration-500 ${data.bgClass} shrink-0`;
            
            const iconContainer = document.getElementById('header-icon-container');
            if(iconContainer) iconContainer.className = `w-10 h-10 shrink-0 rounded-full flex items-center justify-center text-slate-900 shadow-lg shadow-${data.color}-500/50 transition-colors duration-300 bg-${data.color}-500`;
            
            const headerIcon = document.getElementById('header-icon');
            if(headerIcon) headerIcon.className = `fa-solid ${data.icon} text-lg`;

            // 3. Render Content
            renderTables(data.tables, data.color);
            renderMenuCategories(data.color);
            renderMenu(data.drinks, data.color);
            renderActivities(data.activities);
            updateSelectionUI();

            // 4. Feed
            const allUsers = data.tables.flatMap(t => t.members);
            startFeed(allUsers);
        }

        function renderActivities(list) {
            const container = document.getElementById('activity-container');
            if(!container) return;
            
            container.innerHTML = list.map(a => `
                <div onclick="showActivityModal('${a.name}', '${a.date}', '${a.time}')" class="shrink-0 flex items-center gap-2 bg-slate-800/60 rounded-lg p-1.5 pr-3 border border-white/5 min-w-[170px] backdrop-blur-sm hover:bg-slate-700/60 hover:border-amber-500/30 transition-colors cursor-pointer group h-full active:scale-95">
                     <div class="w-9 h-9 rounded-md bg-gradient-to-br from-indigo-500/20 to-purple-500/20 flex flex-col items-center justify-center text-white border border-white/10 shadow-inner group-hover:scale-105 transition-transform shrink-0">
                        <span class="text-[7px] font-mono text-indigo-200 leading-none mb-0.5">${a.date.includes('-') ? a.date.split('-').slice(1).join('/') : 'TODAY'}</span>
                        <span class="text-[9px] font-bold font-mono text-white leading-none">${a.time}</span>
                     </div>
                     <div class="min-w-0">
                         <h4 class="text-sm font-bold text-white leading-tight group-hover:text-amber-300 transition-colors truncate">${a.name}</h4>
                         <div class="flex items-center gap-1 mt-0.5">
                            <div class="w-1 h-1 rounded-full ${a.status === 'Live' ? 'bg-emerald-500 animate-pulse' : 'bg-slate-500'}"></div>
                            <span class="text-[8px] text-slate-400 capitalize">${a.status}</span>
                         </div>
                     </div>
                </div>
            `).join('');
        }

        // --- Render Functions ---
        
        function renderMenuCategories(color) {
             const container = document.getElementById('menu-categories');
             // Reduced spacing for single-line fit: px-3 -> px-1.5, gap-2 -> gap-1, tracking-wider removed
             container.innerHTML = MENU_CATEGORIES.map(cat => {
                 const isActive = cat.id === currentCategory;
                 // Style
                 const activeStyle = isActive ? `text-${color}-400 bg-white/10 border-${color}-500/50` : 'text-slate-500 border-transparent hover:text-slate-300';
                 
                 return `
                    <button onclick="switchCategory('${cat.id}')" 
                            class="flex-shrink-0 px-1.5 py-1.5 rounded-lg border text-[10px] font-bold transition-all flex items-center gap-1 ${activeStyle}">
                        <i class="fa-solid ${cat.icon}"></i>
                        ${cat.name.split('(')[0].trim()}
                    </button>
                 `;
             }).join('');
        }
        
        function switchCategory(catId) {
             currentCategory = catId;
             const data = tribes[currentTribeKey];
             renderMenuCategories(data.color);
             renderMenu(data.drinks, data.color);
        }

        function renderMenu(allDrinks, color) {
            const container = document.getElementById('menu-items-list');
            const filtered = allDrinks.filter(d => d.cat === currentCategory);
            
            if(filtered.length === 0) {
                 container.innerHTML = `<div class="p-4 text-center text-slate-500 text-xs italic">No items in this category</div>`;
                 return;
            }

            container.innerHTML = filtered.map(d => {
                const qty = selectedDrinks[d.id] || 0;
                const isSelected = qty > 0;
                // Highlighting background if selected
                const activeClass = isSelected ? `bg-slate-800/80 border-${color}-500/50 ring-1 ring-${color}-500/30` : 'bg-transparent border-white/5 hover:bg-white/5';
                
                // Controls HTML
                let controlsHtml = '';
                if (qty === 0) {
                    controlsHtml = `
                    <button onclick="updateDrinkQty('${d.id}', 1); event.stopPropagation();" class="w-6 h-6 rounded-full bg-slate-700 hover:bg-${color}-500 text-white flex items-center justify-center transition-all shadow border border-white/20 z-10">
                        <span class="text-sm font-bold leading-none relative top-[-0.5px]">+</span>
                    </button>`;
                } else {
                    controlsHtml = `
                    <div class="flex items-center gap-2" onclick="event.stopPropagation();">
                        <button onclick="updateDrinkQty('${d.id}', -1)" class="w-6 h-6 rounded-full bg-slate-800 border border-slate-600 hover:bg-red-900/50 text-slate-400 hover:text-red-400 flex items-center justify-center transition-colors">
                            <span class="text-sm font-bold leading-none relative top-[-1px]">-</span>
                        </button>
                        <span class="text-xs font-bold text-${color}-400 font-mono select-none min-w-[12px] text-center">${qty}</span>
                        <button onclick="updateDrinkQty('${d.id}', 1)" class="w-6 h-6 rounded-full bg-${color}-500 text-slate-900 hover:bg-${color}-400 flex items-center justify-center transition-colors shadow-sm">
                            <span class="text-sm font-bold leading-none relative top-[-0.5px]">+</span>
                        </button>
                    </div>`;
                }

                return `
                <div class="group relative rounded-xl border p-2 flex items-center gap-3 transition-all ${activeClass}">
                    <div class="w-10 h-10 rounded-lg bg-black/30 flex items-center justify-center text-${color}-400 shadow-inner shrink-0 cursor-pointer" onclick="updateDrinkQty('${d.id}', 1)">
                        <i class="fa-solid ${d.icon} text-lg group-hover:scale-110 transition-transform"></i>
                    </div>
                    
                    <div class="flex-1 min-w-0 self-center">
                        <div class="flex justify-between items-start">
                            <span class="text-xs font-bold text-slate-200 group-hover:text-white truncate cursor-pointer" onclick="updateDrinkQty('${d.id}', 1)">${d.name}</span>
                        </div>
                        <div class="flex justify-between items-center mt-1">
                             <span class="text-[10px] text-amber-500 font-mono">Â¥${d.price}</span>
                        </div>
                    </div>

                    <!-- Right Controls -->
                    <div class="shrink-0 pl-2">
                        ${controlsHtml}
                    </div>
                </div>`;
            }).join('');
        }

        function renderTables(tables, color) {
            const container = document.getElementById('tables-container');
            container.innerHTML = '';
            
            // Define fixed positions for 6 tables (one per tribe)
            const tablePositions = [
                // Row 1 - 3 tables (staggered)
                {x: '26%', y: '52%'}, {x: '46%', y: '36%'}, {x: '82%', y: '30%'},
                // Row 2 - 2 tables (offset)
                {x: '80%', y: '78%'}, {x: '45%', y: '76%'},
                // Row 3 - 1 table
                {x: '65%', y: '52%'}
            ];
            
            // Collect all tables with their tribe info
            let allTables = [];
            Object.entries(tribes).forEach(([tribeKey, tribeData]) => {
                tribeData.tables.forEach((table, idx) => {
                    allTables.push({
                        table,
                        tribeKey,
                        tribeColor: tribeData.color,
                        tribeTitle: tribeData.title,
                        isCurrentTribe: tribeKey === currentTribeKey,
                        tableIndex: idx // Track which table (0,1,2) within the tribe
                    });
                });
            });
            
            // Interleave tables from different tribes across positions
            // Instead of [A1,A2,B1,B2,...] we want [A1,B1,C1,D1,E1,F1,A2,B2,C2,...]
            const tribeKeys = Object.keys(tribes);
            let interleavedTables = [];
            for (let tableIdx = 0; tableIdx < 2; tableIdx++) { // Each tribe has 2 tables
                for (let tribeIdx = 0; tribeIdx < tribeKeys.length; tribeIdx++) {
                    const found = allTables.find(t => t.tribeKey === tribeKeys[tribeIdx] && t.tableIndex === tableIdx);
                    if (found) interleavedTables.push(found);
                }
            }
            
            // Render each table at its position
            interleavedTables.forEach((item, globalIndex) => {
                const pos = tablePositions[globalIndex] || {x: '50%', y: '50%'};
                const {table, tribeKey, tribeColor, tribeTitle, isCurrentTribe} = item;
                
                // Generate seats - positioned at top, bottom, and right only (not left, facing stage)
                const memberCount = table.members.length;
                // Seat angles: top=-90, bottom=90, right=0, top-right=-45, bottom-right=45
                const seatAngles = [
                    [0],              // 1 person: right
                    [-90, 90],        // 2 people: top, bottom
                    [-90, 0, 90],     // 3 people: top, right, bottom
                    [-90, -45, 45, 90] // 4 people: top, top-right, bottom-right, bottom
                ];
                const angles = seatAngles[Math.min(memberCount, 4) - 1] || seatAngles[3];
                
                const seatsHTML = table.members.map((u, i) => {
                    const isSelected = selectedMemberIds.has(u.id);
                    const angle = angles[i % angles.length];
                    const radius = 45; // Larger radius for bigger spacing
                    const x = Math.cos(angle * Math.PI / 180) * radius;
                    const y = Math.sin(angle * Math.PI / 180) * radius;
                    
                    const grayFilter = isCurrentTribe ? '' : 'grayscale opacity-30';
                    const selectedRing = isSelected && isCurrentTribe ? `ring-2 ring-${tribeColor}-400` : '';
                    const selectedScale = isSelected && isCurrentTribe ? 'scale-110' : '';
                    const clickable = isCurrentTribe ? `onclick="toggleMember('${u.id}', '${table.id}')"` : '';
                    const cursorStyle = isCurrentTribe ? 'cursor-pointer hover:scale-110' : 'cursor-default';
                    
                    return `
                    <div id="seat-${u.id}" ${clickable}
                         class="absolute transition-all duration-300 ${cursorStyle} group/seat ${grayFilter} ${selectedScale}"
                         style="left: calc(50% + ${x}px - 12px); top: calc(50% + ${y}px - 12px); z-index: ${isSelected ? '30' : '10'};">
                        <div class="relative">
                            <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=${u.img}&backgroundColor=b6e3f4" 
                                 class="w-7 h-7 rounded-full bg-slate-700 border-2 ${isSelected && isCurrentTribe ? `border-${tribeColor}-400` : 'border-slate-600'} ${selectedRing} transition-all shadow-md ${isSelected && isCurrentTribe ? `shadow-md shadow-${tribeColor}-500/50` : ''}">
                            ${isSelected && isCurrentTribe ? `
                            <div class="absolute -top-0.5 -right-0.5 w-3 h-3 bg-${tribeColor}-500 rounded-full border border-white flex items-center justify-center">
                                <i class="fa-solid fa-check text-[5px] text-white"></i>
                            </div>` : ''}
                            ${isCurrentTribe ? `
                            <div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-1 px-1.5 py-0.5 bg-slate-800/95 rounded text-[8px] whitespace-nowrap opacity-0 group-hover/seat:opacity-100 transition-opacity pointer-events-none border border-white/10 z-40">
                                <div class="font-bold text-white">${u.name}</div>
                            </div>` : ''}
                        </div>
                    </div>`;
                }).join('');

                // Table styling - check if all members selected
                const allMembersSelected = isCurrentTribe && table.members.length > 0 && table.members.every(m => selectedMemberIds.has(m.id));
                const someMembersSelected = isCurrentTribe && table.members.some(m => selectedMemberIds.has(m.id));
                
                const tableOpacity = isCurrentTribe ? '' : 'opacity-30';
                const tableBorder = allMembersSelected ? `border-${tribeColor}-400 border-[3px]` : (isCurrentTribe ? `border-${tribeColor}-500/60` : 'border-slate-700/30');
                const tableGlow = allMembersSelected ? `shadow-lg shadow-${tribeColor}-500/70` : (isCurrentTribe ? `shadow-md shadow-${tribeColor}-500/40` : '');
                const tableBg = allMembersSelected ? `bg-gradient-to-br from-${tribeColor}-900/60 to-${tribeColor}-950/80` : 'bg-gradient-to-br from-amber-900/50 to-amber-950/70';
                const tableScale = allMembersSelected ? 'scale-110' : '';
                const clickableTable = isCurrentTribe ? `onclick="toggleTableAll('${table.id}')"` : '';
                const tableNameColor = allMembersSelected ? `text-white` : (isCurrentTribe ? `text-${tribeColor}-400` : 'text-slate-600');
                
                container.innerHTML += `
                <div class="absolute ${tableOpacity} transition-all duration-300" style="left: ${pos.x}; top: ${pos.y}; transform: translate(-50%, -50%); width: 130px; height: 130px;">
                    <!-- Table Surface -->
                    <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-16 h-16 rounded-full ${tableBg} border-2 ${tableBorder} ${tableGlow} flex items-center justify-center ${isCurrentTribe ? 'cursor-pointer hover:scale-110' : ''} transition-all shadow-lg ${tableScale}"
                         ${clickableTable}>
                        ${allMembersSelected ? `<div class="absolute inset-0 rounded-full bg-${tribeColor}-500/20 animate-pulse"></div>` : ''}
                        <div class="text-center relative z-10">
                            ${allMembersSelected ? `<i class="fa-solid fa-check text-base text-${tribeColor}-300 mb-0.5 block"></i>` : ''}
                            <div class="text-base ${tableNameColor} font-bold leading-none">${table.name.length > 5 ? table.name.substring(0,4) : table.name}</div>
                            ${someMembersSelected && !allMembersSelected ? `<div class="text-[9px] text-${tribeColor}-400 mt-0.5">${table.members.filter(m => selectedMemberIds.has(m.id)).length}/${table.members.length}</div>` : ''}
                        </div>
                    </div>
                    <!-- Tribe color dot / Selection indicator -->
                    <div class="absolute top-0 right-0 w-3.5 h-3.5 rounded-full bg-${tribeColor}-500 ${isCurrentTribe ? '' : 'opacity-30'} border border-white/30 ${allMembersSelected ? 'animate-bounce' : ''}"></div>
                    <!-- Seats -->
                    ${seatsHTML}
                </div>
                `;
            });
            
            // Update legend (smaller)
            const legendContainer = document.getElementById('floor-legend');
            if(legendContainer) {
                legendContainer.innerHTML = Object.entries(tribes).map(([key, data]) => {
                    const isActive = key === currentTribeKey;
                    return `<span class="flex items-center gap-0.5 ${isActive ? 'text-white' : 'text-slate-500'}">
                        <span class="w-1 h-1 rounded-full bg-${data.color}-500 ${isActive ? '' : 'opacity-30'}"></span>
                        <span class="text-[5px]">${data.title.substring(0,2)}</span>
                    </span>`;
                }).join('');
            }
            
            syncTableCheckboxes();
        }
        
        function toggleTableAll(tableId) {
            // Toggle all members of this table
            const data = tribes[currentTribeKey];
            const table = data.tables.find(t => t.id === tableId);
            if (!table) return;
            
            const allSelected = table.members.every(m => selectedMemberIds.has(m.id));
            
            table.members.forEach(m => {
                if (allSelected) {
                    selectedMemberIds.delete(m.id);
                } else {
                    selectedMemberIds.add(m.id);
                }
            });
            
            renderTables(data.tables, data.color);
            updateSelectionUI();
        }

        // --- Interaction Logic ---

        function updateDrinkQty(drinkId, change) {
            const currentQty = selectedDrinks[drinkId] || 0;
            const newQty = currentQty + change;

            if (newQty <= 0) {
                delete selectedDrinks[drinkId];
            } else {
                selectedDrinks[drinkId] = newQty;
            }

            const data = tribes[currentTribeKey];
            renderMenu(data.drinks, data.color);
            updateSelectionUI();
        }

        function toggleMember(memberId, tableId) {
            if (selectedMemberIds.has(memberId)) {
                selectedMemberIds.delete(memberId);
            } else {
                selectedMemberIds.add(memberId);
            }
            updateCardStyle(memberId);
            syncTableCheckboxes();
            updateSelectionUI();
        }

        function toggleTable(tableId) {
            // Legacy function - now handled by toggleTableAll
            toggleTableAll(tableId);
        }

        function syncTableCheckboxes() {
            // No longer needed with the unified floor plan view
            // Kept for compatibility
        }

        function updateCardStyle(memberId) {
            // For the new floor plan view, we need to re-render to update seat styles
            const data = tribes[currentTribeKey];
            renderTables(data.tables, data.color);
        }

        function updateSelectionUI() {
            const memberCount = selectedMemberIds.size;
            const data = tribes[currentTribeKey];
            const color = data.color;
            
            // --- 1. Calculate Totals & Gather Data ---
            let drinkCostPerPerson = 0;
            let totalDrinkCount = 0;
            let selectedDrinkItems = [];

            // Gather Drink Data
            Object.keys(selectedDrinks).forEach(dId => {
                const item = data.drinks.find(d => d.id === dId);
                const qty = selectedDrinks[dId];
                if(item && qty > 0) {
                    drinkCostPerPerson += (item.price * qty);
                    totalDrinkCount += qty;
                    selectedDrinkItems.push({...item, qty});
                }
            });
            
            // Gather Member Data
            let selectedMembers = [];
            if(memberCount > 0) {
                // Flatten all members from tables to find selected ones
                const allMembers = data.tables.flatMap(t => t.members);
                selectedMembers = allMembers.filter(m => selectedMemberIds.has(m.id));
            }

            const finalPrice = memberCount * drinkCostPerPerson;
            
            // --- 2. Update Footer Preview (New Feature) ---
            const previewEl = document.getElementById('selection-preview');
            
            if(memberCount === 0 && totalDrinkCount === 0) {
                previewEl.classList.add('hidden');
                previewEl.classList.remove('flex');
            } else {
                previewEl.classList.remove('hidden');
                previewEl.classList.add('flex');
                
                let html = '';
                
                // Members Row
                if(selectedMembers.length > 0) {
                     html += `<div class="flex items-center gap-2 overflow-x-auto no-scrollbar pb-1 border-b border-white/5 mb-1">
                                <span class="text-[10px] uppercase font-bold text-slate-500 shrink-0">To:</span>`;
                     selectedMembers.forEach(m => {
                         html += `
                            <div class="flex items-center gap-1.5 bg-slate-800/80 rounded-full pl-0.5 pr-2 py-0.5 shrink-0 border border-white/10">
                                <div class="w-4 h-4 rounded-full bg-slate-700 flex items-center justify-center text-[8px] overflow-hidden">
                                     <!-- Ideally img here, using icon for now if no img url logic -->
                                     <span class="font-bold text-slate-300">${m.name[0]}</span>
                                </div>
                                <span class="text-[10px] text-slate-300">${m.name}</span>
                            </div>`;
                     });
                     html += `</div>`;
                }

                // Drinks Row
                if(selectedDrinkItems.length > 0) {
                    html += `<div class="flex items-center gap-2 overflow-x-auto no-scrollbar">
                                <span class="text-[10px] uppercase font-bold text-slate-500 shrink-0">With:</span>`;
                    selectedDrinkItems.forEach(d => {
                        html += `
                           <div class="flex items-center gap-1.5 bg-${color}-900/20 rounded-lg pl-1.5 pr-2 py-0.5 shrink-0 border border-${color}-500/30">
                               <i class="fa-solid ${d.icon} text-[10px] text-${color}-400"></i>
                               <span class="text-[10px] text-${color}-100 max-w-[80px] truncate">${d.name}</span>
                               <span class="text-[10px] font-mono text-amber-500 bg-black/20 px-1 rounded">x${d.qty}</span>
                           </div>`;
                    });
                    html += `</div>`;
                }
                
                previewEl.innerHTML = html;
            }

            // --- 3. Update Button UI ---
            const totalEl = document.getElementById('total-price');
            const countLabel = document.getElementById('selection-count-label');
            const btn = document.getElementById('gift-btn');

            totalEl.innerHTML = `Â¥ ${finalPrice}`;
            countLabel.innerText = memberCount > 0 ? `${memberCount} ä½å¥½å‹` : '';
            
            if (memberCount > 0 && totalDrinkCount > 0) {
                btn.classList.remove('opacity-50', 'pointer-events-none', 'grayscale');
                btn.querySelector('span.text-xs').innerText = `æ”¯ä»˜ & èµ é€`;
            } else {
                btn.classList.add('opacity-50', 'pointer-events-none', 'grayscale');
                if(memberCount === 0) btn.querySelector('span.text-xs').innerText = `è¯·é€‰æ‹©å¥½å‹`;
                else if(totalDrinkCount === 0) btn.querySelector('span.text-xs').innerText = `è¯·é€‰æ‹©é…’å“`;
                else btn.querySelector('span.text-xs').innerText = `ç¡®è®¤èµ é€`;
            }
        }

        function startFeed(users) {
            if(feedInterval) clearInterval(feedInterval);
            const feedEl = document.getElementById('live-feed-text'); // NOTE: This element might not exist in current HTML? 
            // Wait, I think it was removed in previous edits. Or maybe it's in 1.html? 
            // I'm editing 4.html. I don't see 'live-feed-text' in the read_file output.
            // Oh right, I should check if it exists before setting it.
            if(!feedEl) return; 

            const actions = ['åŠ å…¥äº†å°ç»„', 'é€å‡ºäº†ç¤¼ç‰© ğŸ', 'ç‚¹äº†ä¸€é¦–çˆµå£«ä¹ ğŸµ', 'æ­£åœ¨å“å°ç‰¹è°ƒ ğŸ¸', 'æŸ¥çœ‹äº†ä½ çš„ä¸»é¡µ', 'ç‚¹èµäº†å…¨åœº'];
            
            feedInterval = setInterval(() => {
                const randomUser = users[Math.floor(Math.random() * users.length)].name;
                const randomAction = actions[Math.floor(Math.random() * actions.length)];
                feedEl.style.opacity = '0'; 
                setTimeout(() => {
                    feedEl.innerText = `${randomUser} ${randomAction}`;
                    feedEl.style.opacity = '1';
                }, 300);
            }, 3000);
        }

        function goToConfirmation() {
            const data = tribes[currentTribeKey];
            
            // Map selected quantity object back to drink details
            const selectedItemsArray = [];
            Object.keys(selectedDrinks).forEach(dId => {
                const qty = selectedDrinks[dId];
                if(qty > 0) {
                    const originalDrink = data.drinks.find(d => d.id === dId);
                    if(originalDrink) {
                        selectedItemsArray.push({
                            ...originalDrink,
                            qty: qty
                        });
                    }
                }
            });
            
            // Analyze Selected Members for "Table" Logic
            let recipientName = "";
            let recipientType = "single";
            let recipientCount = selectedMemberIds.size;
            
            const selectedTables = [];
            data.tables.forEach(table => {
                const allMembersSelected = table.members.every(m => selectedMemberIds.has(m.id));
                if (allMembersSelected) {
                    selectedTables.push(table.name);
                }
            });

            if (selectedTables.length > 0) {
                // If tables are selected
                recipientType = selectedTables.length > 1 ? "multi" : "group";
                recipientName = selectedTables.join(" & ");
            } else {
                if (recipientCount === 1) {
                     recipientType = "single";
                     // Find the name
                     for(let t of data.tables) {
                         const found = t.members.find(m => selectedMemberIds.has(m.id));
                         if(found) { recipientName = found.name; break; }
                     }
                } else {
                    recipientType = "multi";
                    recipientName = `${recipientCount}ä½å¥½å‹`;
                }
            }

            // Collect detailed member info for 5.html display
            const detailedMembers = [];
            data.tables.forEach(table => {
                table.members.forEach(m => {
                    if (selectedMemberIds.has(m.id)) {
                        detailedMembers.push({
                            name: m.name,
                            img: m.img,
                            table: table.name
                        });
                    }
                });
            });

            // Calculate Total
            // Cost is (Sum of (DrinkPrice * DrinkQty)) * RecipientCount
            // Because you represent "gifting this SET of drinks to EACH person"
            
            let drinkCostPerPerson = 0;
            selectedItemsArray.forEach(item => {
                drinkCostPerPerson += (item.price * item.qty);
            });
            
            const grandTotal = drinkCostPerPerson * recipientCount;

            const payload = {
                tribeTitle: data.title,
                tribeColor: data.color,
                recipient: {
                    name: recipientName,
                    type: recipientType,
                    count: recipientCount,
                    members: detailedMembers 
                },
                items: selectedItemsArray,
                total: grandTotal
            };

            // Store and Navigate
            localStorage.setItem('giftData', JSON.stringify(payload));
            window.location.href = '5.html';
        }

        // Function to update total people count
        function updateTotalPeopleCount() {
            let totalPeople = 0;
            Object.values(tribes).forEach(tribe => {
                tribe.tables.forEach(table => {
                    totalPeople += table.members.length;
                });
            });
            const countEl = document.getElementById('total-people-count');
            if(countEl) {
                countEl.innerHTML = `<i class="fa-solid fa-user-group text-[9px]"></i> ${totalPeople}äººåœ¨æ¡Œ`;
            }
        }

        // Init
        const urlParams = new URLSearchParams(window.location.search);
        const tribeParam = urlParams.get('tribe');
        if (tribeParam && tribes[tribeParam]) {
            selectTribe(tribeParam);
        } else {
            selectTribe('poetic');
        }
        updateTotalPeopleCount();

        // --- Activity Modal Functions ---
        function showActivityModal(activityName, activityDate, activityTime) {
            document.getElementById('modal-activity-name').textContent = activityName;
            document.getElementById('modal-activity-date').textContent = activityDate;
            document.getElementById('modal-activity-time').textContent = activityTime;
            document.getElementById('activity-modal').classList.remove('hidden');
            document.getElementById('activity-modal').classList.add('flex');
            
            // Generate random max members (30, 50, 100, 200)
            const maxOptions = [30, 50, 100, 200];
            const maxMembers = maxOptions[Math.floor(Math.random() * maxOptions.length)];
            
            // Generate random current members (40%-85% of max)
            const minPercent = 0.4;
            const maxPercent = 0.85;
            const percentage = minPercent + Math.random() * (maxPercent - minPercent);
            const currentMembers = Math.floor(maxMembers * percentage);
            
            document.getElementById('modal-current-members').textContent = currentMembers;
            document.getElementById('modal-max-members').textContent = maxMembers;
            
            // Update progress bar
            const barWidth = Math.min(percentage * 100, 100);
            document.getElementById('modal-member-bar').style.width = barWidth + '%';
        }

        function closeActivityModal() {
            document.getElementById('activity-modal').classList.add('hidden');
            document.getElementById('activity-modal').classList.remove('flex');
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('activity-modal');
            if (e.target === modal) {
                closeActivityModal();
            }
        });
        
    </script>

    <!-- Activity Join Modal -->
    <div id="activity-modal" class="hidden fixed inset-0 bg-black/70 backdrop-blur-sm z-50 items-center justify-center p-4">
        <div class="bg-slate-900 border border-white/10 rounded-2xl shadow-2xl max-w-sm w-full overflow-hidden transform transition-all">
            <!-- Modal Header -->
            <div class="bg-gradient-to-r from-amber-900/50 to-orange-900/50 p-4 border-b border-white/10">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-bold text-white">åŠ å…¥æ´»åŠ¨ç¾¤ç»„</h3>
                    <button onclick="closeActivityModal()" class="w-8 h-8 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center text-slate-400 hover:text-white transition-colors">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
                <p id="modal-activity-name" class="text-amber-300 text-sm mt-1">æ´»åŠ¨åç§°</p>
                <!-- Activity Time Info -->
                <div class="flex items-center gap-3 mt-2 text-xs text-slate-300">
                    <span class="flex items-center gap-1">
                        <i class="fa-regular fa-calendar text-amber-400"></i>
                        <span id="modal-activity-date">æ—¥æœŸ</span>
                    </span>
                    <span class="flex items-center gap-1">
                        <i class="fa-regular fa-clock text-amber-400"></i>
                        <span id="modal-activity-time">æ—¶é—´</span>
                    </span>
                </div>
            </div>
            
            <!-- Modal Body -->
            <div class="p-6 flex flex-col items-center">
                <!-- Member Count Info -->
                <div class="w-full bg-slate-800/50 rounded-xl p-3 mb-4 border border-white/5">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-xs text-slate-400 flex items-center gap-1.5">
                            <i class="fa-solid fa-users text-amber-500"></i> ç¾¤ç»„äººæ•°
                        </span>
                        <span class="text-sm font-bold text-white">
                            <span id="modal-current-members" class="text-amber-400">32</span>
                            <span class="text-slate-500">/</span>
                            <span id="modal-max-members">50</span>
                        </span>
                    </div>
                    <div class="w-full h-2 bg-slate-700 rounded-full overflow-hidden">
                        <div id="modal-member-bar" class="h-full bg-gradient-to-r from-amber-500 to-orange-500 rounded-full transition-all duration-500" style="width: 64%"></div>
                    </div>
                </div>
                
                <!-- QR Code -->
                <div class="bg-white p-3 rounded-xl shadow-lg mb-4">
                    <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=åŠæ¯è¯—ç¤¾æ´»åŠ¨ç¾¤" alt="æ´»åŠ¨ç¾¤äºŒç»´ç " class="w-36 h-36">
                </div>
                <p class="text-slate-400 text-xs text-center">æ‰«æäºŒç»´ç åŠ å…¥æ´»åŠ¨ç¾¤ç»„</p>
            </div>
        </div>
    </div>

</body>
</html>