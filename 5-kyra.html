<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gift Confirmation - Multi-Recipient</title>
    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Noto+Serif+SC:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Noto Serif SC', 'serif'],
                        display: ['Playfair Display', 'serif'],
                    },
                    colors: {
                        'neon-pink': '#ec4899',
                        'neon-violet': '#8b5cf6',
                        'glass-surface': 'rgba(255, 255, 255, 0.05)',
                    },
                    animation: {
                        'float-soft': 'floatSoft 6s ease-in-out infinite',
                        'scan': 'scan 3s linear infinite',
                        'pulse-glow': 'pulseGlow 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'aurora': 'aurora 20s linear infinite',
                    },
                    keyframes: {
                        floatSoft: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' },
                        },
                        scan: {
                            '0%': { top: '0%', opacity: 0 },
                            '10%': { opacity: 1 },
                            '90%': { opacity: 1 },
                            '100%': { top: '100%', opacity: 0 },
                        },
                        pulseGlow: {
                            '0%, 100%': { boxShadow: '0 0 10px rgba(139, 92, 246, 0.2)' },
                            '50%': { boxShadow: '0 0 20px rgba(236, 72, 153, 0.5)' },
                        },
                        aurora: {
                            '0%': { backgroundPosition: '0% 50%' },
                            '50%': { backgroundPosition: '100% 50%' },
                            '100%': { backgroundPosition: '0% 50%' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* å…¨å±€éšè—æ‰€æœ‰æ»šåŠ¨æ¡ */
        * {
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE and Edge */
        }
        *::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
            width: 0;
            height: 0;
        }

        body { font-family: 'Inter', sans-serif; }
        .serif-font { font-family: 'Noto Serif SC', serif; }

        .hide-scroll::-webkit-scrollbar { width: 4px; }
        .hide-scroll::-webkit-scrollbar-track { background: transparent; }
        .hide-scroll::-webkit-scrollbar-thumb { background: #334155; border-radius: 2px; }

        /* æ·±æ¸ŠèƒŒæ™¯ */
        .abyssal-bg {
            background-color: #020617;
            background-image:
                radial-gradient(circle at 15% 50%, rgba(30, 27, 75, 0.4) 0%, transparent 25%),
                radial-gradient(circle at 85% 30%, rgba(15, 23, 42, 0.6) 0%, transparent 25%);
            min-height: 100vh;
        }

        /* ç»ç’ƒé¢æ¿ */
        .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.03);
            border-radius: 20px;
        }
        .checkbox-wrapper input:checked + div {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(236, 72, 153, 0.2) 100%);
            border-color: #8b5cf6;
            box-shadow: 0 0 15px rgba(139, 92, 246, 0.3);
        }
        .checkbox-wrapper input:checked + div .check-icon {
            opacity: 1;
            transform: scale(1);
        }
        .receipt-tear {
            background-image: radial-gradient(circle at 10px 0, transparent 10px, #0f172a 11px);
            background-size: 20px 10px;
            background-repeat: repeat-x;
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }
        
        /* Bg Animation */
        .bg-aurora {
            background: linear-gradient(-45deg, #0f172a, #1e1b4b, #312e81, #0f172a);
            background-size: 400% 400%;
        }

        /* Dynamic Background */
        .mystic-bg {
            background-color: #020617;
            background-image:
                radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%),
                radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%),
                radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%);
            position: absolute; inset: 0; z-index: -1;
        }

        
            50% { opacity: 0.95; transform: translateY(-50vh) translateX(var(--drift)); }
            95% { opacity: 0.8; }
            100% { transform: translateY(-100vh) translateX(calc(var(--drift) * 1.5)); opacity: 0; }
        }
    </style>
</head>
<body class="text-slate-200 min-h-screen relative font-sans overflow-x-hidden">

    <div class="mystic-bg"></div>
    <!-- WRAPPER for Sidebar layout -->
    <div class="relative z-10 flex flex-col md:flex-row min-h-screen p-2 md:p-4 gap-4 max-w-7xl mx-auto">
        <!-- å·¦ä¾§å¯¼èˆªæ  -->
        <aside class="glass-panel w-full lg:w-64 flex flex-col p-6 shadow-2xl shrink-0 lg:h-[calc(100vh-3rem)] lg:sticky lg:top-6">
            <div class="mb-8 flex lg:block items-center justify-between">
                <div>
                    <p class="text-[10px] text-amber-700/80 tracking-[0.3em] font-bold">EST. 2026</p>
                    <h1 class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-br from-amber-100 to-amber-600 serif-font mt-1">
                        åŠæ¯è¯—ç¤¾
                    </h1>
                </div>
                <button class="lg:hidden text-slate-400">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                    </svg>
                </button>
            </div>

            <!-- å¯¼èˆªèœå• -->
            <nav class="hidden lg:flex flex-col gap-2 flex-1">
                <a href="1.html" class="flex items-center gap-3 px-4 py-3 text-slate-500 hover:text-slate-300 hover:bg-white/5 rounded-xl transition-all group">
                    <svg class="w-5 h-5 group-hover:text-amber-500/50 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                    </svg>
                    <span>å¤§å… Hall</span>
                </a>
                <a href="2.html" class="flex items-center gap-3 px-4 py-3 text-slate-500 hover:text-slate-300 hover:bg-white/5 rounded-xl transition-all group">
                    <svg class="w-5 h-5 group-hover:text-amber-500/50 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                    </svg>
                    <span>æ–°äººå‘å¯¼ Guide</span>
                </a>
                <a href="3.html" class="flex items-center gap-3 px-4 py-3 text-slate-500 hover:text-slate-300 hover:bg-white/5 rounded-xl transition-all group">
                    <svg class="w-5 h-5 group-hover:text-amber-500/50 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
                    </svg>
                    <span>å¾®é†ºä¼šè¯ Session</span>
                </a>
                <a href="4.html" class="flex items-center gap-3 px-4 py-3 text-slate-500 hover:text-slate-300 hover:bg-white/5 rounded-xl transition-all group">
                    <svg class="w-5 h-5 group-hover:text-amber-500/50 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                    </svg>
                    <span>åœˆå­ Circles</span>
                </a>
                <a href="6.html" class="flex items-center gap-3 px-4 py-3 text-slate-500 hover:text-slate-300 hover:bg-white/5 rounded-xl transition-all group">
                    <svg class="w-5 h-5 group-hover:text-amber-500/50 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    <span>æˆ‘çš„æ¡£æ¡ˆ Profile</span>
                </a>
            </nav>

            <!-- ç”¨æˆ·ä¿¡æ¯ -->
            <div class="hidden lg:flex mt-auto pt-6 border-t border-white/5 items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-amber-900/30 border border-amber-500/20 flex items-center justify-center text-amber-500 font-bold text-xs ring-4 ring-black">
                    ME
                </div>
                <div>
                    <p class="text-sm text-amber-500/80 font-bold">é…’å®¢ #0608</p>
                    <p class="text-[10px] text-slate-500">å¾®é†ºæ¢é™©å®¶</p>
                </div>
            </div>
        </aside>

        <main class="flex-1 w-full min-w-0 flex flex-col">
    <!-- MAIN CARD -->
    <div class="relative z-10 w-full max-w-5xl bg-gray-800/80 backdrop-blur-xl rounded-3xl shadow-2xl flex flex-col md:flex-row border border-white/10 overflow-hidden animate-float-soft ring-1 ring-white/10">
        
        <!-- LEFT: ORDER & RECIPIENT INFO -->
        <div class="w-full md:w-2/5 bg-slate-900 border-r border-white/5 flex flex-col relative">
            <div class="p-5 md:p-6 pb-4 relative z-10">
                <!-- Background decoration -->
                <div class="absolute top-0 right-0 w-64 h-64 bg-purple-600/10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 pointer-events-none"></div>

                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-bold tracking-widest text-slate-400 uppercase flex items-center gap-2">
                        <i class="fa-solid fa-receipt"></i> è®¢å•è¯¦æƒ…
                    </h2>
                    <!-- Toggle Button (Text Removed) -->
                    <button onclick="toggleRecipientMode()" class="w-8 h-8 flex items-center justify-center bg-white/5 hover:bg-white/10 rounded-full border border-white/10 text-slate-400 hover:text-white transition group" title="åˆ‡æ¢æ¥æ”¶äººæ¨¡å¼">
                        <i class="fa-solid fa-rotate group-hover:rotate-180 transition-transform duration-500"></i>
                    </button>
                </div>

                <!-- 1. DYNAMIC RECIPIENT CARD -->
                <div id="recipient-card" class="bg-gradient-to-br from-indigo-900/40 to-slate-800 rounded-xl p-4 mb-4 relative overflow-hidden group hover:border-indigo-400/50 transition-colors cursor-default">
                    <!-- Glow effect -->
                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-indigo-500 to-pink-500"></div>
                    
                    <div class="text-[10px] text-indigo-300 uppercase font-bold tracking-wider mb-3 flex items-center justify-between">
                        <span>To whom (æ¥æ”¶å¯¹è±¡)</span>
                        <span id="recipient-type-badge" class="bg-indigo-500/20 px-2 py-0.5 rounded text-indigo-200">å…¨ç»„ Group</span>
                    </div>

                    <!-- Mode A: Whole Group -->
                    <div id="mode-group" class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-xl bg-indigo-600 flex items-center justify-center text-white shrink-0 shadow-lg shadow-indigo-500/30 relative overflow-hidden">
                            <i class="fa-solid fa-users text-xl relative z-10"></i>
                            <div class="absolute inset-0 bg-white/10 animate-pulse"></div>
                        </div>
                        <div>
                            <div class="text-lg font-bold text-white leading-tight">æ¸…çˆ½æœé¦™æ´¾ Â· å…¨å‘˜</div>
                            <div class="text-xs text-slate-400 mt-1 flex items-center gap-2">
                                <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                                å½“å‰æ´»è·ƒ: 24äºº
                            </div>
                        </div>
                    </div>

                    <!-- Mode B: Specific Person -->
                    <div id="mode-single" class="hidden flex items-center gap-4">
                        <div class="relative w-12 h-12">
                            <img src="https://i.pravatar.cc/150?u=a042581f4e29026024d" class="w-12 h-12 rounded-full border-2 border-indigo-500 object-cover">
                            <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-slate-900 rounded-full"></div>
                        </div>
                        <div>
                            <div class="text-lg font-bold text-white leading-tight">Alice</div>
                            <div class="text-xs text-slate-400 mt-1 flex items-center gap-1">
                                <i class="fa-solid fa-location-dot text-pink-500"></i> å§å° 03å·æ¡Œ
                            </div>
                        </div>
                    </div>

                     <!-- Mode C: Multiple People -->
                     <div id="mode-multi" class="hidden flex flex-col gap-2">
                        <div class="flex items-center -space-x-3 overflow-visible pl-2">
                            <img src="https://i.pravatar.cc/150?u=12" class="w-10 h-10 rounded-full border-2 border-slate-800 z-30 transition hover:scale-110 hover:z-40">
                            <img src="https://i.pravatar.cc/150?u=23" class="w-10 h-10 rounded-full border-2 border-slate-800 z-20 transition hover:scale-110 hover:z-40">
                            <img src="https://i.pravatar.cc/150?u=45" class="w-10 h-10 rounded-full border-2 border-slate-800 z-10 transition hover:scale-110 hover:z-40">
                            <div class="w-10 h-10 rounded-full bg-slate-700 border-2 border-slate-800 z-0 flex items-center justify-center text-xs font-bold text-slate-300 shadow-lg">+2</div>
                        </div>
                        <div class="text-sm font-bold text-white mt-1">Bob, Jack, Rose... (å…±5äºº)</div>
                    </div>
                </div>

                <!-- 2. ORDER DETAILS (Expanded) -->
                <div class="bg-white/5 rounded-2xl p-4 border border-white/5 space-y-4">
                    <h3 class="text-xs font-bold text-slate-500 uppercase">Items (ç‚¹é¤å†…å®¹)</h3>
                    
                    <!-- Item 1 -->
                    <div class="flex gap-3 group">
                        <div class="w-12 h-12 rounded-lg overflow-hidden bg-slate-800 shrink-0 relative">
                            <i class="fa-solid fa-martini-glass-citrus absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-emerald-500/30 text-xl z-0"></i>
                            <img src="https://images.unsplash.com/photo-1551024709-8f23befc6f87?w=200&h=200&fit=crop" 
                                 alt="Mojito" 
                                 onerror="this.style.display='none'; this.previousElementSibling.style.opacity='1'"
                                 class="w-full h-full object-cover group-hover:scale-110 transition duration-700 relative z-10">
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between items-start">
                                <div class="text-sm font-bold text-emerald-400">Mojito ç‰¹è°ƒ</div>
                                <div class="text-sm">Â¥ 12.00</div>
                            </div>
                            <div class="text-xs text-slate-400">x <span id="qty-display">24</span> (Less Sugar)</div>
                        </div>
                    </div>

                    <!-- Item 2 -->
                    <div class="flex gap-3 group">
                        <div class="w-12 h-12 rounded-lg overflow-hidden bg-slate-800 shrink-0 relative">
                            <i class="fa-solid fa-bowl-food absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-amber-500/30 text-xl z-0"></i>
                            <img src="https://images.unsplash.com/photo-1630384060421-a4323ce56d1b?w=200&h=200&fit=crop" 
                                 alt="Potato Wedges" 
                                 onerror="this.style.display='none'; this.previousElementSibling.style.opacity='1'"
                                 class="w-full h-full object-cover group-hover:scale-110 transition duration-700 relative z-10">
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between items-start">
                                <div class="text-sm font-bold text-amber-400">è–¯è§’æ‹¼ç›˜</div>
                                <div class="text-sm">Â¥ 45.00</div>
                            </div>
                            <div class="text-xs text-slate-400">x 5 (Share Size)</div>
                        </div>
                    </div>

                    <div class="h-px bg-white/10 my-2"></div>
                    <div class="flex justify-between items-center text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-emerald-400 to-cyan-400">
                        <span>Total Pay</span>
                        <span>Â¥ 513.00</span>
                    </div>
                </div>
            </div>
            
            <div class="hidden md:block flex-1 bg-slate-900/50"></div>
            <!-- Receipt Edge -->
            <div class="h-4 w-full receipt-tear absolute bottom-0 md:-bottom-4 left-0 z-20 opacity-80"></div>
        </div>

        <!-- RIGHT: SOCIAL & MESSAGE -->
        <div class="w-full md:w-3/5 bg-slate-800/50 p-5 md:p-6 flex flex-col backdrop-blur-3xl">
            <div class="mb-4">
                <h2 class="text-xl font-bold text-white mb-1 flex items-center gap-2">
                    æ¥è‡ªè°çš„å¿ƒæ„ï¼Ÿ
                    <i class="fa-solid fa-heart text-pink-500 animate-pulse"></i>
                </h2>
                <p class="text-slate-400 text-xs">Let them know who made their night special.</p>
            </div>

            <!-- Contact Section (Checkbox Based) -->
            <div class="mb-4">
                <label class="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2">
                    è”ç³»æ–¹å¼ (Safe Connect) <span class="text-[10px] font-normal normal-case opacity-70 ml-2">- å¯å¤šé€‰</span>
                </label>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <!-- WeChat Option -->
                    <label class="checkbox-wrapper block cursor-pointer group">
                        <input type="checkbox" class="hidden peer" id="check-wechat" checked onchange="toggleContact('wechat')">
                        <div class="bg-gray-900/50 border border-white/10 rounded-xl p-3 transition-all duration-300 group-hover:border-white/20 relative overflow-hidden h-full flex flex-col justify-between">
                            <div class="flex items-center justify-between z-10 relative">
                                <div class="flex items-center gap-2">
                                    <div class="w-8 h-8 rounded-full bg-emerald-600/20 text-emerald-400 flex items-center justify-center text-sm shrink-0">
                                        <i class="fa-brands fa-weixin"></i>
                                    </div>
                                    <div class="min-w-0">
                                        <div class="text-xs font-bold text-white truncate">å¾®ä¿¡åç‰‡</div>
                                        <div class="text-[10px] text-slate-400 truncate">æ‰«ç æ·»åŠ </div>
                                    </div>
                                </div>
                                <!-- Checkbox Circle -->
                                <div class="w-5 h-5 rounded-full border-2 border-white/20 flex items-center justify-center transition-colors shrink-0 peer-checked:border-emerald-500 peer-checked:bg-emerald-500">
                                    <i class="fa-solid fa-check text-[10px] text-white opacity-0 transition-all duration-300 check-icon"></i>
                                </div>
                            </div>

                            <!-- Expandable Content: QR -->
                            <div id="content-wechat" class="mt-3 pt-3 border-t border-white/10 flex items-center gap-3 transition-all duration-500 origin-top overflow-hidden">
                                <div class="relative w-16 h-16 bg-white rounded-lg p-1 shrink-0 group-hover:scale-105 transition-transform duration-300 shadow-lg">
                                    <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=WeChatFriendRequest" class="w-full h-full object-cover">
                                    <div class="absolute inset-0 bg-gradient-to-b from-transparent via-emerald-400/30 to-transparent h-1/2 w-full animate-scan opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"></div>
                                </div>
                                <div class="text-[10px] text-slate-400 leading-tight">
                                    <p class="mb-1 text-slate-300">ä¸´æ—¶äºŒç»´ç </p>
                                    <p>30åˆ†é’Ÿæœ‰æ•ˆ</p>
                                </div>
                            </div>
                        </div>
                    </label>

                    <!-- Phone Option -->
                    <label class="checkbox-wrapper block cursor-pointer group">
                        <input type="checkbox" class="hidden peer" id="check-phone" onchange="toggleContact('phone')">
                        <div class="bg-gray-900/50 border border-white/10 rounded-xl p-3 transition-all duration-300 group-hover:border-white/20 relative h-full flex flex-col justify-between">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <div class="w-8 h-8 rounded-full bg-amber-600/20 text-amber-400 flex items-center justify-center text-sm shrink-0">
                                        <i class="fa-solid fa-phone"></i>
                                    </div>
                                    <div class="min-w-0">
                                        <div class="text-xs font-bold text-white truncate">æ‰‹æœºå·ç </div>
                                        <div class="text-[10px] text-slate-400 truncate">éšç§ä¿æŠ¤</div>
                                    </div>
                                </div>
                                <div class="w-5 h-5 rounded-full border-2 border-white/20 flex items-center justify-center transition-colors shrink-0 peer-checked:border-blue-500 peer-checked:bg-blue-500">
                                    <i class="fa-solid fa-check text-[10px] text-white opacity-0 transition-all duration-300 check-icon"></i>
                                </div>
                            </div>

                            <!-- Expandable Content: Input -->
                            <div id="content-phone" class="hidden mt-3 pt-3 border-t border-white/10">
                                <div class="relative w-full">
                                    <i class="fa-solid fa-mobile-screen absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 text-xs"></i>
                                    <input type="text" value="139 **** 9999" class="w-full bg-slate-900 border border-white/10 rounded-lg py-2 pl-8 pr-3 text-xs text-white font-mono focus:border-blue-500 focus:outline-none transition-colors group-hover:bg-slate-800">
                                </div>
                            </div>
                        </div>
                    </label>
                </div>
            </div>

            <!-- Message Section -->
            <div class="flex-1 flex flex-col min-h-[160px]">
                <div class="flex justify-between items-center mb-3">
                    <label class="text-xs font-bold text-slate-500 uppercase tracking-widest">èµ è¨€ (Message)</label>
                    <span id="char-count" class="text-[10px] text-slate-600">0/50</span>
                </div>
                
                <div class="flex flex-wrap gap-2 mb-3">
                    <span onclick="addTag('Cheers!')" class="cursor-pointer px-3 py-1.5 rounded-full text-xs bg-pink-500/10 border border-pink-500/30 text-pink-300 hover:bg-pink-500/20 transition hover:scale-105 select-none">âœ¨ Cheers!</span>
                    <span onclick="addTag('é‡è§å³æ˜¯ç¼˜åˆ†')" class="cursor-pointer px-3 py-1.5 rounded-full text-xs bg-purple-500/10 border border-purple-500/30 text-purple-300 hover:bg-purple-500/20 transition hover:scale-105 select-none">ğŸ¤ ç¼˜åˆ†</span>
                    <span onclick="addTag('å¾ˆé«˜å…´è®¤è¯†å¤§å®¶')" class="cursor-pointer px-3 py-1.5 rounded-full text-xs bg-amber-500/10 border border-amber-500/30 text-amber-300 hover:bg-amber-500/20 transition hover:scale-105 select-none">ğŸ‘‹ å¹¸ä¼š</span>
                </div>

                <div class="relative flex-1 group">
                    <textarea id="message-area" class="w-full h-full min-h-[100px] bg-slate-900/50 border border-white/10 rounded-xl p-4 text-white placeholder-slate-600 resize-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500 transition-all font-serif italic text-sm leading-relaxed" placeholder="å†™ä¸‹ä½ å¯¹è¿™æ¯é…’çš„æœŸå¾…..."></textarea>
                    
                    <button class="absolute bottom-3 right-3 text-slate-500 hover:text-white transition group-hover:scale-110">
                        <i class="fa-solid fa-pen-fancy"></i>
                    </button>
                </div>
            </div>

            <!-- FOOTER -->
            <div class="mt-4 pt-4 border-t border-white/5 flex flex-col sm:flex-row items-center justify-between gap-4">
                <button id="sendBtn" onclick="sendMessage()" class="w-full bg-gradient-to-r from-neon-pink to-purple-600 text-white px-8 py-3.5 rounded-xl font-bold shadow-lg shadow-purple-900/50 hover:scale-[1.02] hover:shadow-purple-700/50 transition-all flex items-center justify-center gap-3 group relative overflow-hidden">
                    <div class="absolute inset-0 bg-white/20 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700"></div>
                    <span id="btnText">ç¡®è®¤æ”¯ä»˜ & æœºå™¨äººé€é¤</span>
                    <i id="btnIcon" class="fa-solid fa-robot group-hover:translate-x-1 group-hover:-translate-y-1 transition-transform"></i>
                </button>
            </div>

        </div>
    </div>
        </main>
    </div>

    <script>
        // Init from LocalStorage
        document.addEventListener('DOMContentLoaded', () => {
            const rawData = localStorage.getItem('giftData');
            if (rawData) {
                const data = JSON.parse(rawData);
                renderPage(data);
            }
        });

        function renderPage(data) {
            // 1. Recipient Info
            const typeMap = { 'single': 'å•äºº Single', 'group': 'å…¨ç»„ Group', 'multi': 'å¤šäºº Multi' };
            const badge = document.getElementById('recipient-type-badge');
            if(badge) badge.innerText = typeMap[data.recipient.type] || 'Group';

            // Hide legacy modes
            ['mode-group', 'mode-single', 'mode-multi'].forEach(id => {
                const el = document.getElementById(id);
                if(el) el.classList.add('hidden');
            });

            // Target Container for New Table-Based View
            const recipientContainer = document.getElementById('recipient-card');
            
            // Remove any previously injected details to avoid dupes on re-renders
            const existingDetails = document.getElementById('injected-recipient-details');
            if(existingDetails) existingDetails.remove();

            const detailsDiv = document.createElement('div');
            detailsDiv.id = 'injected-recipient-details';
            detailsDiv.className = 'flex flex-col gap-3 mt-2';

            const bgColors = {
                'violet': 'bg-violet-600',
                'rose': 'bg-rose-600',
                'amber': 'bg-amber-600',
                'cyan': 'bg-cyan-600'
            };
            const themeBg = bgColors[data.tribeColor] || 'bg-indigo-600';

            if (data.recipient.members && data.recipient.members.length > 0) {
                // Group by Table
                const groups = {};
                data.recipient.members.forEach(m => {
                    const tName = m.table || "Others";
                    if(!groups[tName]) groups[tName] = [];
                    groups[tName].push(m);
                });

                Object.keys(groups).forEach(tableName => {
                    const members = groups[tableName];
                    const groupHtml = `
                        <div class="bg-black/20 rounded-xl p-3 border border-white/5">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="bg-white/10 px-2 py-0.5 rounded text-[10px] text-slate-400 font-mono uppercase tracking-wider">${tableName}</span>
                                <span class="h-px bg-white/10 flex-1"></span>
                            </div>
                            <div class="flex flex-wrap gap-2">
                                ${members.map(m => `
                                    <div class="flex items-center gap-2 bg-slate-800/50 rounded-full pr-3 pl-1 py-1 border border-white/5">
                                        <div class="w-6 h-6 rounded-full bg-slate-700 flex items-center justify-center text-xs font-bold text-slate-300 relative overflow-hidden">
                                            ${m.img && !m.img.includes('http') ? m.name[0] : `<img src="${m.img}" class="w-full h-full object-cover">`}
                                        </div>
                                        <span class="text-xs text-slate-300">${m.name}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    detailsDiv.innerHTML += groupHtml;
                });
            } else {
                // Fallback for logic where members list might be empty (legacy)
                detailsDiv.innerHTML = `<div class="p-2 text-slate-400 text-sm italic">No specific members details passed.</div>`;
            }
            
            // Insert into the DOM
            recipientContainer.appendChild(detailsDiv);


            // 2. Order Details
            // Use a more relaxed selector or get by index if class strings are fragile
            // The file has "bg-white/5 rounded-2xl p-4 border border-white/5 space-y-4"
            const itemContainer = document.querySelector('.bg-white\\/5.rounded-2xl');
            
            if(itemContainer) {
                const header = itemContainer.querySelector('h3');
                const footer = itemContainer.querySelector('.bg-clip-text'); 
                const divider = itemContainer.querySelector('.h-px');

                let html = '';
                
                // Show items ONLY ONCE in the summary list, but indicate Quantity per Person
                // data.items has {qty: X} per item
                
                data.items.forEach(item => {
                     const totalQtyForOnePerson = item.qty;
                     const totalQtyAll = item.qty * data.recipient.count;
                     
                     html += `
                        <div class="flex gap-3 group">
                            <div class="w-12 h-12 rounded-lg overflow-hidden bg-slate-800 shrink-0 relative flex items-center justify-center">
                                <i class="fa-solid ${item.icon || 'fa-martini-glass'} text-${data.tribeColor || 'emerald'}-500/50 text-xl z-0"></i>
                                <span class="absolute top-0 right-0 bg-${data.tribeColor || 'emerald'}-500 text-white text-[9px] font-bold px-1 rounded-bl-lg shadow">x${totalQtyForOnePerson}</span>
                            </div>
                            <div class="flex-1">
                                <div class="flex justify-between items-start">
                                    <div class="text-sm font-bold text-slate-200">${item.name}</div>
                                    <div class="text-sm font-mono text-amber-500">Â¥ ${item.price}</div>
                                </div>
                                <div class="flex justify-between items-end mt-1">
                                     <div class="text-[10px] text-slate-400">Total: ${totalQtyAll} servings</div>
                                     <div class="text-[10px] text-slate-500">Sub: Â¥ ${item.price * totalQtyAll}</div>
                                </div>
                            </div>
                        </div>
                     `;
                });
                
                itemContainer.innerHTML = '';
                if(header) itemContainer.appendChild(header);
                
                const contentDiv = document.createElement('div');
                contentDiv.className = "space-y-3 mt-3 mb-3";
                contentDiv.innerHTML = html;
                itemContainer.appendChild(contentDiv);
                
                if(divider) itemContainer.appendChild(divider);
                if(footer) {
                    footer.querySelectorAll('span')[1].innerText = `Â¥ ${data.total}`;
                    itemContainer.appendChild(footer);
                }
            }
        }

        function sendMessage() {
            const wechat = document.getElementById('check-wechat');
            const phone = document.getElementById('check-phone');
            
            if (!wechat.checked && !phone.checked) return;

            const btn = document.getElementById('sendBtn');
            const originalClass = btn.className;
            const originalHTML = btn.innerHTML;

            // Success State
            btn.className = "w-full bg-emerald-600 text-white px-8 py-3.5 rounded-xl font-bold shadow-lg shadow-emerald-900/50 scale-95 transition-all flex items-center justify-center gap-3 relative overflow-hidden";
            btn.innerHTML = `<i class="fa-solid fa-check"></i> <span>æ”¯ä»˜ & å‘é€æˆåŠŸ</span>`;

            setTimeout(() => {
                document.getElementById('message-area').value = '';
                btn.className = originalClass;
                btn.innerHTML = originalHTML;
            }, 1000);
        }

        function toggleRecipientMode() {
            // Disabled manual toggle if data is driven, or keep for demo
            console.log("Mode is controlled by selection now.");
        }

        // Updated for Checkboxes
        function toggleContact(type) {
            const checkbox = document.getElementById(`check-${type}`);
            const content = document.getElementById(`content-${type}`);
            
            if (checkbox.checked) {
                content.classList.remove('hidden');
            } else {
                content.classList.add('hidden');
            }
            updateButtonState();
        }

        function updateButtonState() {
            const wechat = document.getElementById('check-wechat').checked;
            const phone = document.getElementById('check-phone').checked;
            const btn = document.getElementById('sendBtn');
            
            if (!wechat && !phone) {
                // Disable
                btn.classList.add('opacity-50', 'grayscale', 'pointer-events-none');
                btn.classList.remove('shadow-lg', 'hover:scale-[1.02]');
            } else {
                // Enable
                btn.classList.remove('opacity-50', 'grayscale', 'pointer-events-none');
                btn.classList.add('shadow-lg', 'hover:scale-[1.02]');
            }
        }

        // Init Button State on Load
        document.addEventListener('DOMContentLoaded', () => {
             updateButtonState();
        });

        function addTag(text) {
            const area = document.getElementById('message-area');
            if (area.value) {
                area.value += " " + text;
            } else {
                area.value = text;
            }
        }

        
    </script>
</body>
</html>